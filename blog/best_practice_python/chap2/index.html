
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="http://www.jieyu.ai/blog/best_practice_python/chap2/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.0">
    
    
      
        <title>2 构建虚拟运行时环境 - 解语科技</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.33e2939f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ef6f36e2.min.css">
        
          
          
          <meta name="theme-color" content="#02a6f2">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../../../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../../../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../../../css/pandas-dataframe.css">
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-27842639-4","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="light-blue" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#构建python虚拟运行时环境" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="解语科技" class="md-header__button md-logo" aria-label="解语科技" data-md-component="logo">
      
  <img src="../../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            解语科技
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2 构建虚拟运行时环境
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/zillionare/zillionare/" title="前往 GitHub 仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    zillionare
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../.." class="md-tabs__link">
      欢迎
    </a>
  </li>

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../zillionare/tutorial/preface/" class="md-tabs__link">
        量化教程
      </a>
    </li>
  

  

      
        
  
  
    
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../chap1/" class="md-tabs__link md-tabs__link--active">
        博客
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../products/" class="md-tabs__link">
        产品和下载
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="https://www.zhihu.com/column/jieyu" class="md-tabs__link">
      知乎专栏
    </a>
  </li>

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="解语科技" class="md-nav__button md-logo" aria-label="解语科技" data-md-component="logo">
      
  <img src="../../../assets/logo.png" alt="logo">

    </a>
    解语科技
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/zillionare/zillionare/" title="前往 GitHub 仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    zillionare
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        欢迎
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        量化教程
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="量化教程" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          量化教程
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" >
      
      <label class="md-nav__link" for="__nav_2_1">
        量化交易教程
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="量化交易教程" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          量化交易教程
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../zillionare/tutorial/preface/" class="md-nav__link">
        序
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../zillionare/tutorial/chap1/" class="md-nav__link">
        1 证券列表、板块和K线数据
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../zillionare/tutorial/chap2/" class="md-nav__link">
        2 可视化
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      <label class="md-nav__link" for="__nav_3">
        博客
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="博客" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          博客
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" checked>
      
      <label class="md-nav__link" for="__nav_3_1">
        Python工程最佳实践
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Python工程最佳实践" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Python工程最佳实践
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../chap1/" class="md-nav__link">
        1 开发环境和IDE
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          2 构建虚拟运行时环境
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        2 构建虚拟运行时环境
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#构建python虚拟运行时环境" class="md-nav__link">
    构建Python虚拟运行时环境
  </a>
  
    <nav class="md-nav" aria-label="构建Python虚拟运行时环境">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#安装conda" class="md-nav__link">
    安装conda
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#修改源" class="md-nav__link">
    修改源
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#创建虚拟环境" class="md-nav__link">
    创建虚拟环境
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pip" class="md-nav__link">
    pip
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#配置vscode中的解释器" class="md-nav__link">
    配置vscode中的解释器
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#思考题" class="md-nav__link">
    思考题
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../chap3/" class="md-nav__link">
        3 工程布局与向导
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../chap4/" class="md-nav__link">
        4 Poetry - 依赖管理和打包
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../chap5/" class="md-nav__link">
        5 高效编码
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        产品和下载
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="产品和下载" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          产品和下载
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../products/" class="md-nav__link">
        大富翁
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://www.zhihu.com/column/jieyu" class="md-nav__link">
        知乎专栏
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#构建python虚拟运行时环境" class="md-nav__link">
    构建Python虚拟运行时环境
  </a>
  
    <nav class="md-nav" aria-label="构建Python虚拟运行时环境">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#安装conda" class="md-nav__link">
    安装conda
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#修改源" class="md-nav__link">
    修改源
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#创建虚拟环境" class="md-nav__link">
    创建虚拟环境
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pip" class="md-nav__link">
    pip
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#配置vscode中的解释器" class="md-nav__link">
    配置vscode中的解释器
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#思考题" class="md-nav__link">
    思考题
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/zillionare/zillionare/edit/master/docs/blog/best_practice_python/chap2.md" title="编辑此页" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  <h1>2 构建虚拟运行时环境</h1>
                
                <h2 id="构建python虚拟运行时环境">构建Python虚拟运行时环境<a class="headerlink" href="#构建python虚拟运行时环境" title="Permanent link">&para;</a></h2>
<p>任何一个程序员都不可能从头到脚去开发程序的每一个模块。我们必然要借鉴和使用他人的开发成果，同时也希望我们的开发成果被更多的人使用。这样就必然引出一个问题： 如果我们的程序中使用了他人开发的模块，并且使用了它的早期版本；而另一个程序也使用了同样的模块，但使用的是晚期版本，这时候两个程序应该如何共存？</p>
<p>Python是我知道的最早通过创建虚拟运行时来解决这个问题的开发语言。开发者可以为自己的应用程序构建单独的虚拟运行时环境，在这个环境里，所有的第三方模块都只为这一个应用程序服务，因此它们的版本可以固定下来。在一台机器中，可以同时存在多个虚拟环境，也可以同时运行基于多个虚拟环境的多个应用程序。此外，用户安装您的应用程序时，通过创建虚拟Python运行时，也解决了权限问题--因为您不再需要去修改系统自带的Python环境了。</p>
<details class="readmore"><summary>Readmore</summary><p>这个问题的出现至少可以追溯的Windows的早期。在Windows中，这些共享库以DLL（动态链接库）的形态出现。由于不同的版本相互冲突，导致出现了被称为DLL地狱的现象出现。为了解决这个问题，就出现了通过虚拟机从操作系统层面进行隔离的解决方案，随后又进化出基于docker的容器隔离方案。这些都是系统级的深度隔离，不仅程序文件之间不会冲突，就连网络资源和计算资源都是完全隔离的。运行在不同的虚拟环境中的程序，彼此无法看到对方的存在，它们可以打开同样的网络端口，读写同样路径中的文件而不会冲突--因为这些文件实际上并不是一个。</p>
<p>Python的虚拟运行时只是程序文件这样的静态资源的隔离。同一主机上运行的不同Python虚拟运行时，彼此可以感知到对方的存在 -- 比如，可以在一个程序中去kill掉另一个程序；两个程序不能监听在同一个端口；如果读写相同位置的文件，则可能造成该文件损害等等。Python虚拟运行时能够保证的，就是运行在两个不同运行时中的程序库，可以有不同的版本。</p>
</details>
<p>Python中存在多种构建虚拟运行时的方案，在本教程中我们推荐使用conda，但是也会用到venv和virtual env。</p>
<details class="readmore"><summary>Readmore</summary><p>Python中创建虚拟运行时的工具众多，包括pyenv, pyvenv, pipenv, virtualenv, pyenv-virtualenv, virtualenvwrapper,pyenv-virtualenvwrapper,pipenv, conda等。如此众多的工具存在，既反应了Python社区的活跃度，也反应了Python长期以来在打包、发行方面缺乏标准的现实。不过，情况正在起变化。</p>
<p>Python为什么能支持虚拟运行时？这主要是因为，Python解释器被设计成为这样运行：当它根据import指令去查找module时，首先从自身所在的路径的相对路径下查起。因此，只要把应用程序的依赖库与Python安装在一起，那么Python就会首先使用这些依赖库，而不是安装在别的什么地方的依赖库。</p>
<p>如此众多的工具，大致可以分为四个流派：</p>
<p>pyenv及其变种（pyenv-*)主要基于shell script hook技术，仅能工作在Linux机器上。它将许多不同版本的Python安装在~/.pyenv路径下，并向系统路径中的Python插入一个楔子。然后您通过.python-version来指定应该使用哪一个Python，这样在调用Python时，这个楔子就能根据您指定的Python版本，来调用真正的Python解释器。基于pyenv的工作原理，可以看出，它不能完全满足我们创建Python虚拟运行时的那些要求，即为每一个应用创建自己专门的、与其它应用完全隔离的运行时。</p>
<p><a href="https://virtualenv.pypa.io/en/latest/">Virtualenv</a>及venv是第二个流派。Virtualenv允许你为每一个应用程序都创建自己专门的、与其它应用程序完全隔离的运行时，这个运行时，一般就与您的应用程序文件安装在一起。从Python 3.3起，Virtualenv的一部分代码进入到标准库，即venv。随Python 3.3还一起发布了一个pyvenv的script，不过在3.6版本时就被标记为depreacted了。因此，Virtualenv和venv现在是创建Python虚拟运行时的主流工具，也被其它广泛使用的工具如tox，poetry所接纳。</p>
<p>在venv成为标准库之后，为什么还需要使用Virtualenv呢？Virtualenv的官方说明是，Virtualenv性能更好，速度快，可以通过pip升级，以及更好扩展，API更丰富（毕竟venv只是它的一个子集）。</p>
<p>pipenv是第三个流派，它的功能主要是两点，一是创建虚拟环境，二是进行依赖管理。不过pipenv在2018年11月到2020年4月间没有任何更新，这也导致了一部分用户流失（最近一段时间似乎又开始维护了）。现在社区更认可的依赖管理工具已经是Poetry了。</p>
<p>第四个流派则是[conda[(https://docs.conda.io/projects/conda/en/latest/index.html)。Conda不完全是一个Python的虚拟环境构建工具，它是一个服务于Python，R，Ruby，Lua，Scala，Java等语言的发行包、依赖管理和运行时环境管理工具。</p>
<p>与Virtualenv相比，conda提供的功能相当于Virtualenv + pip，当然您也可以在conda环境下使用pip。conda构建虚拟环境默认是集中式的，virtualenv则是分散式的，与应用程序安装在一起。两者在空间占用上也有较大区别，一个空的conda环境会占用122MB左右的空间，而空的virtualenv环境则只占用12MB空间，显然，使用virtualenv创建虚拟运行环境会更快。</p>
<p>在我们的工作中，应该如何选择呢？首先，如果您在开发跟tox, poetry类似的软件，即需要随时构建新的一次性虚拟环境的，应该使用virtualenv或者venv；在我们自己的开发及应用程序部署中，推荐使用conda，毕竟这种长期使用的虚拟环境，更适合conda这种集中式管理模式。这种情况下，conda所占用的空间、以及创建虚拟环境所用的时间也可以忽略不计了。</p>
</details>
<h3 id="安装conda">安装conda<a class="headerlink" href="#安装conda" title="Permanent link">&para;</a></h3>
<p>Conda共有两个版本，anaconda和miniconda。</p>
<p>多数从事数据科学的人会安装完整的anaconda。这一般会占用你硬盘上好几个G的初始空间，并且随着虚拟环境的创建持续增长。对从事工程开发的人来说，则可以从miniconda开始。两者的区别是，前者包含了很多科学计算用的工程包，比如numpy, scipy， sklearn等等，还有一个名为spyder的集成开发工具。后者只包含了包和虚拟环境管理系统。</p>
<p>Miniconda的下载地址在<a href="https://docs.conda.io/en/latest/miniconda.html">这里</a>。一般是50M上下，包含了一个基本的Python解释器。Miniconda的python版本并不重要，因为后面我们都将为虚拟环境安装特定版本的Python。</p>
<p>我们将Miniconda安装到WSL中，因此，我们应该运行下面的命令（如果您使用Ubuntu，这些命令也是一样的，下同）：
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>sh &lt;<span class="o">(</span>curl -s https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh<span class="o">)</span>
</code></pre></div>
</td></tr></table></p>
<p><img alt="" src="http://images.jieyu.ai/images/2020-10/20201012220906.png" /></p>
<p>如果WSL上没有安装curl，请先通过<code>suod apt install curl</code>来安装。</p>
<p>从anaconda官网上下载miniconda可能较慢，也可以先通过下载工具将上述文件下载下来，再传入到WSL中去。</p>
<h3 id="修改源">修改源<a class="headerlink" href="#修改源" title="Permanent link">&para;</a></h3>
<p>与apt一样，在国内使用时，我们先要配置一下conda源，否则安装速度会很慢，甚至无法安装成功。</p>
<p>修改~/.condarc如下：</p>
<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>channels:
    - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/
    - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/
    - https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/
    - https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/pytorch/
ssl_verify: true
</code></pre></div>
</td></tr></table>
上面的配置使用了清华的源，也可以使用如下中科大的源：
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>channels:
    - https://mirrors.ustc.edu.cn/anaconda/pkgs/main/
    - https://mirrors.ustc.edu.cn/anaconda/pkgs/free/
    - https://mirrors.ustc.edu.cn/anaconda/cloud/conda-forge/
ssl_verify: true
</code></pre></div>
</td></tr></table></p>
<details class="tips"><summary>Tips</summary><p>配置源需要记忆一些URL，我们也可以使用<a href="https://pypi.org/project/cfg4py/">cfg4py</a>来帮助我们。
首先，安装cfg4py:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># 首先安装cfg4py</span>
pip install cfg4py

<span class="c1"># 让cfg4py提示我们如何更改conda源</span>
cfg4py hint conda --usage
</code></pre></div>
</td></tr></table>
<p>我们将得到以下输出：
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>Usage: execute command:
conda config --add channels %url
or edit your ~/.condarc to add the following:

- tsinghua:
    channels:
    - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/
    - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/
    - https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/
    - https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/pytorch/
    ssl_verify: <span class="nb">true</span>
- ustc:
    channels:
    - https://mirrors.ustc.edu.cn/anaconda/pkgs/main/
    - https://mirrors.ustc.edu.cn/anaconda/pkgs/free/
    - https://mirrors.ustc.edu.cn/anaconda/cloud/conda-forge/
    ssl_verify: <span class="nb">true</span>
</code></pre></div>
</td></tr></table>
cfg4py还可以提示如何配置pip源，apt源等。</p>
</details>
<h3 id="创建虚拟环境">创建虚拟环境<a class="headerlink" href="#创建虚拟环境" title="Permanent link">&para;</a></h3>
<p>我们使用conda来创建虚拟环境：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>conda create -n your_env_name <span class="nv">python</span><span class="o">=</span><span class="m">3</span>.8
</code></pre></div>
</td></tr></table>
<p>上面的命令将在你的miniconda安装目录的envs目录下，创建一个名为your_env_name的文件夹，并将python 3.8及相关文件安装到这个目录下。安装完成时，conda会提示你使用以下命令：
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>conda activate your_env_name  <span class="c1">#激活python虚拟环境</span>
conda deactivate              <span class="c1">#退出当前的虚拟环境</span>
</code></pre></div>
</td></tr></table></p>
<p>当虚拟环境激活时，命令提示符一般会显示为虚拟环境名字；此时运行python，会启动当前虚拟环境下安装的Python版本，而此后加载的Python库，都来自于该虚拟环境下通过conda或者pip命令安装的库。</p>
<p>关于conda还有一些常见的命令，这里一并提一下：
1. conda env list, 显示本机上所有的虚拟环境
2. conda env remove, 移除一个虚拟环境
3. conda create -n your_virutal_env --clone your_another_env，从另一个已存在的虚拟环境中创建。Conda没有改名的操作，所以如果要给一个虚拟环境改名，我们可以先clone，再删除掉旧的虚拟环境。
4. conda install, 安装软件到当前环境
5. conda search， 查找是否存在某个软件</p>
<details class="tips"><summary>Tips</summary><p>在上面的创建命令中，使用的是CPython发行版。conda还允许您使用特殊的Python版本，比如Intel发行版：
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>conda update conda
conda config --add channels intel
conda create -n idp intelpython3_core <span class="nv">python</span><span class="o">=</span><span class="m">3</span>
</code></pre></div>
</td></tr></table></p>
<p>使用Intel版的Python的一个原因是，它可能提供了更强性能的数学计算功能。具体可以看<a href="https://software.intel.com/en-us/articles/using-intel-distribution-for-python-with-anaconda">这里</a>。这对从事数据分析为主的程序员还是比较有帮助的。</p>
</details>
<h2 id="pip">pip<a class="headerlink" href="#pip" title="Permanent link">&para;</a></h2>
<p>构建虚拟环境当然少不了安装第三方库。前面提过了可以通过conda来安装Python库，但是，Python库最重要的发行系统是<a href="https://pypi.org">pypi</a>，它的客户端则是pip。pypi整个系统由<a href="https://pypi.org/simple">中央服务器(central repo)</a>及分布在各地的镜像服务器组成服务器；pip客户端用来从服务器上搜索和下载python库；此外，客户端还提供安装、卸载、查询本地已安装库的功能。</p>
<p>pip和pipenv都是<a href="https://www.pypa.io/en/latest/">pypa(Python Packaging Authority (PyPA)</a>的产品。</p>
<h2 id="配置vscode中的解释器">配置vscode中的解释器<a class="headerlink" href="#配置vscode中的解释器" title="Permanent link">&para;</a></h2>
<p>在上一章中讲到，安装完成ms-python扩展后，最重要的配置是配置Python解释器。</p>
<h2 id="思考题">思考题<a class="headerlink" href="#思考题" title="Permanent link">&para;</a></h2>
<ol>
<li>有哪三个重要原因，使得我们需要创建Python虚拟运行环境？</li>
<li>什么是virtualenv? 它与venv是什么关系？</li>
<li>什么是pipenv?现在一般使用什么工具来替换pipenv?</li>
<li>什么是conda？conda有哪两个发行版本？如何进行选择？</li>
<li>为什么要替换conda源？国内有哪些conda源可以使用？</li>
<li>conda与virtualenv有何区别？</li>
<li>要使用一个python库，我们应该如何去搜索和安装？</li>
</ol>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../chap1/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                上一页
              </span>
              1 开发环境和IDE
            </div>
          </div>
        </a>
      
      
        <a href="../chap3/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                下一页
              </span>
              3 工程布局与向导
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
  <div class="md-footer-social">
    
      
      
      <a href="https://www.zhihu.com/club/1243142164264886272" target="_blank" rel="noopener" title="知乎圈子" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M170.54 148.13v217.54l23.43.01 7.71 26.37 42.01-26.37h49.53V148.13H170.54zm97.75 193.93h-27.94l-27.9 17.51-5.08-17.47-11.9-.04V171.75h72.82v170.31zm-118.46-94.39H97.5c1.74-27.1 2.2-51.59 2.2-73.46h51.16s1.97-22.56-8.58-22.31h-88.5c3.49-13.12 7.87-26.66 13.12-40.67 0 0-24.07 0-32.27 21.57-3.39 8.9-13.21 43.14-30.7 78.12 5.89-.64 25.37-1.18 36.84-22.21 2.11-5.89 2.51-6.66 5.14-14.53h28.87c0 10.5-1.2 66.88-1.68 73.44H20.83c-11.74 0-15.56 23.62-15.56 23.62h65.58C66.45 321.1 42.83 363.12 0 396.34c20.49 5.85 40.91-.93 51-9.9 0 0 22.98-20.9 35.59-69.25l53.96 64.94s7.91-26.89-1.24-39.99c-7.58-8.92-28.06-33.06-36.79-41.81L87.9 311.95c4.36-13.98 6.99-27.55 7.87-40.67h61.65s-.09-23.62-7.59-23.62v.01zm412.02-1.6c20.83-25.64 44.98-58.57 44.98-58.57s-18.65-14.8-27.38-4.06c-6 8.15-36.83 48.2-36.83 48.2l19.23 14.43zm-150.09-59.09c-9.01-8.25-25.91 2.13-25.91 2.13s39.52 55.04 41.12 57.45l19.46-13.73s-25.67-37.61-34.66-45.86h-.01zM640 258.35c-19.78 0-130.91.93-131.06.93v-101c4.81 0 12.42-.4 22.85-1.2 40.88-2.41 70.13-4 87.77-4.81 0 0 12.22-27.19-.59-33.44-3.07-1.18-23.17 4.58-23.17 4.58s-165.22 16.49-232.36 18.05c1.6 8.82 7.62 17.08 15.78 19.55 13.31 3.48 22.69 1.7 49.15.89 24.83-1.6 43.68-2.43 56.51-2.43v99.81H351.41s2.82 22.31 25.51 22.85h107.94v70.92c0 13.97-11.19 21.99-24.48 21.12-14.08.11-26.08-1.15-41.69-1.81 1.99 3.97 6.33 14.39 19.31 21.84 9.88 4.81 16.17 6.57 26.02 6.57 29.56 0 45.67-17.28 44.89-45.31v-73.32h122.36c9.68 0 8.7-23.78 8.7-23.78l.03-.01z"/></svg>
      </a>
    
      
      
      <a href="https://qm.qq.com/cgi-bin/qm/qr?k=kErrI22lCmhKXN8we_iY7jS2sBPnXk8_&jump_from=webapi" target="_blank" rel="noopener" title="量化交易群" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741 0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792 0 0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704z"/></svg>
      </a>
    
      
      
      <a href="https://github.com/zillionare" target="_blank" rel="noopener" title="Github" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
      <a href="mailto:code@jieyu.ai" target="_blank" rel="noopener" title="" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m20 8-8 5-8-5V6l8 5 8-5m0-2H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.indexes", "navigation.tabs", "navigation.instant", "navigation.tabs.sticky"], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../../assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.d892486b.min.js"></script>
      
    
  </body>
</html>