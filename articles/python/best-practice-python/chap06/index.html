


    
















<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="解剖量化框架软件,解读量化策略,分享量化课程与资源 for all quant traders">
      
      
      
        <link rel="canonical" href="http://www.jieyu.ai/articles/python/best-practice-python/chap06/">
      
      
        <link rel="prev" href="../chap05/">
      
      
        <link rel="next" href="../chap07/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS 订阅" href="../../../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="已更新内容的 RSS 订阅" href="../../../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.2">
    
    
    <title>06 10倍速！高效编码 - 大富翁量化</title>

    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../overrides/stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../../../overrides/stylesheets/katex.min.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-EHVH3XCS1V"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-EHVH3XCS1V",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-EHVH3XCS1V",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
    
    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="06 10倍速！高效编码 - 大富翁量化" />
    <meta property="og:description" content=" - 解剖量化框架软件,解读量化策略,分享量化课程与资源 for all quant traders" />
    <meta property="og:url" content="http://www.jieyu.ai/articles/python/best-practice-python/chap06/" />
    <meta property="og:image" content="http://www.jieyu.ai/assets/banner.jpg" />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />

    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="06 10倍速！高效编码 - 大富翁量化" />
    <meta name="twitter:description" content=" - 解剖量化框架软件,解读量化策略,分享量化课程与资源 for all quant traders" />
    <meta name="twitter:image" content="http://www.jieyu.ai/assets/banner.jpg" />

  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1-ai" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../.." title="大富翁量化" class="md-header__button md-logo" aria-label="大富翁量化" data-md-component="logo">
      
  <img src="../../../../assets/img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            大富翁量化
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              06 10倍速！高效编码
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/zillionare/zillionare" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    zillionare
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../blog" class="md-tabs__link">
        
  
    
  
  首页

      </a>
    </li>
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../coursea/cheese/intro/" class="md-tabs__link">
          
  
    
  
  量化课程

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../products/" class="md-tabs__link">
          
  
    
  
  量化产品

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../investment/%E7%AD%96%E7%95%A5%E7%A0%94%E7%A9%B6/capm/" class="md-tabs__link">
          
  
    
  
  策略研究

        </a>
      </li>
    
  

    
  

    
  

      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../chap01/" class="md-tabs__link">
          
  
    
  
  学Python

        </a>
      </li>
    
  

    
  

    
  

    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../tags" class="md-tabs__link">
        
  
    
  
  文章分类

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../contact/" class="md-tabs__link">
          
  
    
  
  联系和关注

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
    
    

    <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
        <div class="md-sidebar__scrollwrap">
            <div class="md-sidebar__inner">
                


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="大富翁量化" class="md-nav__button md-logo" aria-label="大富翁量化" data-md-component="logo">
      
  <img src="../../../../assets/img/logo.png" alt="logo">

    </a>
    大富翁量化
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/zillionare/zillionare" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    zillionare
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../blog" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    首页
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    量化课程
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            量化课程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    大富翁量化课程
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            大富翁量化课程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../coursea/cheese/intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    课程简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../coursea/cheese/outline/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    课程大纲
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    量化产品
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            量化产品
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../products/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    产品系列
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            产品系列
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../products/zillionare_installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    大富翁安装指南
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../products/gm-adaptor-installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    实盘交易接口
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    策略研究
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            策略研究
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    量化知识
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            量化知识
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1_1" id="__nav_4_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    策略研究
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_1">
            <span class="md-nav__icon md-icon"></span>
            策略研究
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../investment/%E7%AD%96%E7%95%A5%E7%A0%94%E7%A9%B6/capm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    资本资产定价模型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../investment/%E7%AD%96%E7%95%A5%E7%A0%94%E7%A9%B6/mpt-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    投资组合理论与实战(1) - 基本概念
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../investment/%E7%AD%96%E7%95%A5%E7%A0%94%E7%A9%B6/mpt-2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    投资组合理论与实战(2) - 蒙特卡洛方法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../investment/%E7%AD%96%E7%95%A5%E7%A0%94%E7%A9%B6/mpt-3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    投资组合理论与实战(3) - 优化算法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../investment/%E7%AD%96%E7%95%A5%E7%A0%94%E7%A9%B6/mpt-4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    投资组合理论与实战(4) - PyportfolioOpt工具库
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../investment/%E7%AD%96%E7%95%A5%E7%A0%94%E7%A9%B6/%E5%85%B3%E4%BA%8E%E5%AF%BB%E6%89%BE%E9%A1%B6%E5%92%8C%E5%BA%95%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    关于寻找顶和底的一些思考
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_2" >
        
          
          <label class="md-nav__link" for="__nav_4_1_2" id="__nav_4_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    量化库
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_2">
            <span class="md-nav__icon md-icon"></span>
            量化库
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../investment/%E9%87%8F%E5%8C%96%E5%BA%93/%E5%AE%9E%E7%9B%98%E6%8E%A5%E5%85%A5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    量化实盘接入方式
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../investment/%E9%87%8F%E5%8C%96%E5%BA%93/%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    量化数据的持久化方案
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_3" >
        
          
          <label class="md-nav__link" for="__nav_4_1_3" id="__nav_4_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    量化杂谈
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_3">
            <span class="md-nav__icon md-icon"></span>
            量化杂谈
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../investment/%E9%87%8F%E5%8C%96%E6%9D%82%E8%B0%88/tulipmania/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    花开曾倾国
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../investment/%E9%87%8F%E5%8C%96%E6%9D%82%E8%B0%88/voc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    东印度公司
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    学Python
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            学Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" checked>
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Python
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1" checked>
        
          
          <label class="md-nav__link" for="__nav_5_1_1" id="__nav_5_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    专题
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_1_1">
            <span class="md-nav__icon md-icon"></span>
            专题
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_1" checked>
        
          
          <label class="md-nav__link" for="__nav_5_1_1_1" id="__nav_5_1_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Python能做大项目
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_1_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_1_1_1">
            <span class="md-nav__icon md-icon"></span>
            Python能做大项目
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chap01/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    01 为什么要学 Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chap02/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    02 编程开发环境
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chap03/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    03 构建Python虚拟环境
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chap04/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    04 项目布局和项目生成向导
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chap05/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    05 Poetry 项目管理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    06 10倍速！高效编码
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    06 10倍速！高效编码
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#11-github-copilot" class="md-nav__link">
    <span class="md-ellipsis">
      1.1. github copilot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-tabnine" class="md-nav__link">
    <span class="md-ellipsis">
      1.2. tabnine
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chap07/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    07 代码单元测试
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chap08/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    08 代码版本管理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chap09/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    09 持续集成
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chap10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10 撰写技术文档
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chap11/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    11 发布应用
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_2" >
        
          
          <label class="md-nav__link" for="__nav_5_1_2" id="__nav_5_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    数据分析与可视化
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_2">
            <span class="md-nav__icon md-icon"></span>
            数据分析与可视化
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualize/dash/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dash-用Python也能做网页
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualize/how-to-scale/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    量化策略中如何进行缩放和归一化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualize/matplotlib-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    matplotlib的布局问题（1）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualize/matplotlib-2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    matplotlib的布局问题（2）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualize/qq-plot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    为什么Q-Q图可用来进行统计推断
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tags" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    文章分类
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    联系和关注
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            联系和关注
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../contact/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contact
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>

                
                
                    <br>
                    <br>
                    <div class="tag-cloud-nav">
                        





  

  

  

  

  

  

  

  

  

  

  

  

  
    
    
      
        
      
    
      
        
        
        
        
          
          
        
        
        
          
        
      
    
      
        
        
        
        
          
          
        
          
          
        
        
        
          
        
      
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
    
      
        
        
        
        
          
          
            
            
            
          
        
          
          
        
          
          
        
        
        
      
    
      
        
        
        
        
          
          
        
          
          
        
          
          
        
        
        
          
        
      
    
      
        
        
        
        
          
          
        
          
          
        
          
          
        
          
          
        
        
        
          
        
      
    
  

  
    
    
      
        
        
        
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
        
        
          
        
      
    
      
        
        
        
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
        
        
          
        
      
    
      
        
        
        
        
          
          
        
          
          
        
          
          
        
          
          
            
            
            
          
        
          
          
        
          
          
        
          
          
        
        
        
      
    
  

  
    
    
      
        
        
        
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
        
        
          
        
      
    
      
        
        
        
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
        
        
          
        
      
    
  

  
    
    
      
        
        
        
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
            
            
            
          
        
          
          
        
          
          
        
          
          
        
        
        
      
    
      
        
        
        
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
            
            
            
          
        
          
          
        
          
          
        
        
        
      
    
      
        
        
        
        
          
          
        
          
          
        
          
          
        
          
          
            
            
            
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
        
        
      
    
  

  
    
    
      
        
        
        
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
            
            
            
          
        
          
          
        
        
        
      
    
  

  
    
    
      
        
        
        
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
            
            
            
          
        
          
          
        
        
        
      
    
      
        
        
        
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
        
        
          
        
      
    
  

  
    
    
      
        
        
        
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
            
            
            
          
        
        
        
      
    
      
        
        
        
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
            
            
            
          
        
          
          
        
          
          
        
        
        
      
    
  

  
    
    
      
        
        
        
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
        
        
          
        
      
    
      
        
        
        
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
        
        
          
        
      
    
      
        
        
        
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
            
            
            
          
        
          
          
        
          
          
        
          
          
        
          
          
        
        
        
      
    
      
        
        
        
        
          
          
        
          
          
        
          
          
        
          
          
            
            
            
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
        
        
      
    
      
        
        
        
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
        
        
          
        
      
    
  

  
    
    
      
        
        
        
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
            
            
            
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
        
        
      
    
  

  
    
    
      
        
        
        
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
        
        
          
        
      
    
      
        
        
        
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
            
            
            
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
        
        
      
    
  

  
    
    
      
        
        
        
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
            
            
            
          
        
          
          
        
          
          
        
          
          
        
          
          
        
        
        
      
    
  

  
    
    
      
        
        
        
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
            
            
            
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
        
        
      
    
  

  
    
    
      
        
        
        
        
          
          
            
            
            
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
        
        
      
    
  

  

  

  

  

  

  

  

  

  

  


<style>
    .tag-cloud {
        margin-top:1em;
        margin-bottom: 0.5em;
    }
    .tag-cloud-content {
        padding: 0 0.6rem;
        
    }
</style>

<p class="md-nav tag-cloud">
  <label class="md-nav__title">Tag cloud</label>
</p>
<div class="tag-cloud-content">
    
        
            
            
            
            <a class="tag" href="http://www.jieyu.ai/tags/#quantlib">
                <span class="tag-name" style="
                    
                        
                    
                        font-size:0.65rem;
                    
                    color:DarkViolet;
                ">quantlib&nbsp;
                </span>
                <!--<sup class="tag-count">3</sup>-->
            </a>
        
            
            
            
            <a class="tag" href="http://www.jieyu.ai/tags/#qmt">
                <span class="tag-name" style="
                    
                        
                    
                        font-size:0.55rem;
                    
                    color:DarkGoldenrod;
                ">qmt&nbsp;
                </span>
                <!--<sup class="tag-count">1</sup>-->
            </a>
        
            
            
            
            <a class="tag" href="http://www.jieyu.ai/tags/#量化实盘">
                <span class="tag-name" style="
                    
                        
                    
                        font-size:0.55rem;
                    
                    color:DarkTurquoise;
                ">量化实盘&nbsp;
                </span>
                <!--<sup class="tag-count">1</sup>-->
            </a>
        
            
            
            
            <a class="tag" href="http://www.jieyu.ai/tags/#python">
                <span class="tag-name" style="
                    
                        
                    
                        font-size:0.7rem;
                    
                    color:DarkSlateBlue;
                ">python&nbsp;
                </span>
                <!--<sup class="tag-count">4</sup>-->
            </a>
        
            
            
            
            <a class="tag" href="http://www.jieyu.ai/tags/#xtquant">
                <span class="tag-name" style="
                    
                        
                    
                        font-size:0.65rem;
                    
                    color:DarkTurquoise;
                ">xtquant&nbsp;
                </span>
                <!--<sup class="tag-count">3</sup>-->
            </a>
        
            
            
            
            <a class="tag" href="http://www.jieyu.ai/tags/#quant">
                <span class="tag-name" style="
                    
                        
                    
                        font-size:0.6rem;
                    
                    color:DarkMagenta;
                ">quant&nbsp;
                </span>
                <!--<sup class="tag-count">2</sup>-->
            </a>
        
            
            
            
            <a class="tag" href="http://www.jieyu.ai/tags/#algorithm">
                <span class="tag-name" style="
                    
                        
                    
                        font-size:0.6rem;
                    
                    color:DarkOrchid;
                ">algorithm&nbsp;
                </span>
                <!--<sup class="tag-count">2</sup>-->
            </a>
        
            
            
            
            <a class="tag" href="http://www.jieyu.ai/tags/#strategy">
                <span class="tag-name" style="
                    
                        
                    
                        font-size:0.8rem;
                    
                    color:DarkRed;
                ">strategy&nbsp;
                </span>
                <!--<sup class="tag-count">6</sup>-->
            </a>
        
            
            
            
            <a class="tag" href="http://www.jieyu.ai/tags/#技术指标">
                <span class="tag-name" style="
                    
                        
                    
                        font-size:0.55rem;
                    
                    color:DarkCyan;
                ">技术指标&nbsp;
                </span>
                <!--<sup class="tag-count">1</sup>-->
            </a>
        
            
            
            
            <a class="tag" href="http://www.jieyu.ai/tags/#factor">
                <span class="tag-name" style="
                    
                        
                    
                        font-size:0.65rem;
                    
                    color:DarkSlateBlue;
                ">factor&nbsp;
                </span>
                <!--<sup class="tag-count">3</sup>-->
            </a>
        
            
            
            
            <a class="tag" href="http://www.jieyu.ai/tags/#algorithms">
                <span class="tag-name" style="
                    
                        
                    
                        font-size:0.55rem;
                    
                    color:DarkMagenta;
                ">algorithms&nbsp;
                </span>
                <!--<sup class="tag-count">1</sup>-->
            </a>
        
            
            
            
            <a class="tag" href="http://www.jieyu.ai/tags/#machine learning">
                <span class="tag-name" style="
                    
                        
                    
                        font-size:0.55rem;
                    
                    color:DarkOliveGreen;
                ">machine learning&nbsp;
                </span>
                <!--<sup class="tag-count">1</sup>-->
            </a>
        
            
            
            
            <a class="tag" href="http://www.jieyu.ai/tags/#sklearn">
                <span class="tag-name" style="
                    
                        
                    
                        font-size:0.55rem;
                    
                    color:DarkSlateBlue;
                ">sklearn&nbsp;
                </span>
                <!--<sup class="tag-count">1</sup>-->
            </a>
        
            
            
            
            <a class="tag" href="http://www.jieyu.ai/tags/#数据源">
                <span class="tag-name" style="
                    
                        
                    
                        font-size:0.55rem;
                    
                    color:DarkOliveGreen;
                ">数据源&nbsp;
                </span>
                <!--<sup class="tag-count">1</sup>-->
            </a>
        
    
</div>
                    </div>
                
                <br/>
                
            </div>
        </div>
    </div>



    

    <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
        <div class="md-sidebar__scrollwrap">
            <div class="md-sidebar__inner">
                
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#11-github-copilot" class="md-nav__link">
    <span class="md-ellipsis">
      1.1. github copilot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-tabnine" class="md-nav__link">
    <span class="md-ellipsis">
      1.2. tabnine
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                

                
                
                <br/>
                
            </div>
        </div>
    </div>


          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
    

    <a href="https://github.com/zillionare/zillionare/edit/master/docs/articles/python/best-practice-python/chap06.md" title="edit.link.title" class="md-content__button md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
    </a>



<style>
    .md-typeset .cover {
        margin-bottom: 1em;
    }
    .md-typeset .page-category {
        color: gray;
        font-size: large;
    }
    .md-typeset .page-title {
        margin-left: -0.0625em;
    }
    .md-typeset .page-extra {
        color: gray;
        font-size: small;
    }
    .md-typeset .page-tags {
        margin: 0;
    }
    .md-typeset .page-date {
        margin: 0;
        text-align: end;
    }
    @media print {
        .md-typeset .cover {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .md-typeset .cover + * {
            margin-top: 0;
        }
    }
</style>

<div class="cover">
    
    

    
    <h1 class="page-title"> 06 10倍速！高效编码 </h1>

    
    

    
        <div class="page-extra row">
            <div class="col">
            

            </div>
            <div class="col">
                <p class="page-date">
                    <span>
                    
                        最后更新:
                        2023-12-15
                    
                    </span>
                </p>
            </div>
        </div>
    
</div>

<hr class="screen-only">


<style>
    .md-typeset .toc {
        display: none;
    }
    .md-typeset .toc label {
        display: none;
    }
    .md-typeset .toc .md-nav {
        font-size: unset;
        line-height: 1.6;
    }
    .md-typeset .toc .md-nav--secondary {
        margin-left: -2em;
    }
    .md-typeset .toc .md-nav__list {
        margin: 0;
    }
    .md-typeset .toc ul {
        list-style: none;
    }
    @media print {
        .md-typeset .toc {
            display: block;
            page-break-after: always;
        }
        .md-typeset .toc .md-nav__link {
            color: var(--md-typeset-a-color);
        }
        .md-typeset .toc .md-nav__link.md-nav__link--active {
            font-weight: unset;
        }
        .md-typeset .toc + * {
            margin-top: 0;
        }
    }
</style>

<div class="toc">
    <h2>Table of Content</h2>
    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#11-github-copilot" class="md-nav__link">
    <span class="md-ellipsis">
      1.1. github copilot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-tabnine" class="md-nav__link">
    <span class="md-ellipsis">
      1.2. tabnine
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
</div>



    
    <h1 id="1-ai">1. AI赋能的代码编写<a class="headerlink" href="#1-ai" title="Permanent link">&para;</a></h1>
<p>传统上，IDE的重要功能之一，就是代码自动完成、语法高亮、文档提示、错误诊断等等。随着人类进入深度学习时代，AI辅助编码则让程序员如虎添翼。</p>
<p>我们首先介绍几个AI辅助编码的工具，然后再介绍常规的语法高亮、文档提示等功能。</p>
<h2 id="11-github-copilot">1.1. github copilot<a class="headerlink" href="#11-github-copilot" title="Permanent link">&para;</a></h2>
<p>github copilot是github官方出品的AI辅助编码工具。它是基于大规模语料、超大规模的深度学习模型，结合了大量的编程经验，为开发者提供代码补全、代码片段联想、代码推荐等功能。copilot可以根据用户输入的一行注释，自动生成代码片段甚至整个函数，功能十分强大。</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>2023年12月，微软把他们基于chatGPT的人工智能搜索引擎技术也称为copilot，它是您在使用bing搜索引擎时，出现的一个对话机器人。Github现在也是微软的资产。</p>
</div>
<p>比如，我们写一段注释如下：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># create a fibonacci series up to nth term</span>
</code></pre></div></td></tr></table></div>
然后回车，copilot就会写出下面的代码:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">n</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
这个函数还有一个尾递归版本，当然copilot也能提供。一般情况下，copilot能提供10个以内的备选答案。</p>
<p>我们再举一个例子，如果有以下注释：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>设置npm中国加速镜像
</code></pre></div></td></tr></table></div>
你会立即得到以下代码：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>cnpm<span class="w"> </span>--registry<span class="o">=</span>https://registry.npm.taobao.org
</code></pre></div></td></tr></table></div>
再也不用记忆这些奇怪的设置了！</p>
<p>我们再试一个例子:</p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># 读取csv文件，并返回一个数组对象</span>
<span class="k">def</span> <span class="nf">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>

<span class="c1"># 将数组对象转换为json字符串</span>
<span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># 将json发送到github</span>
<span class="k">def</span> <span class="nf">send_json</span><span class="p">(</span><span class="n">json_data</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://api.github.com/repos/udacity/ud120-projects/issues&#39;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># 请填写你的token</span>
    <span class="p">}</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json_data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;foo.csv&#39;</span><span class="p">)</span>
    <span class="n">json_data</span> <span class="o">=</span> <span class="n">to_json</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">send_json</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
在上述例子中，我们只写了三行注释，copilot自动帮我们填充了代码。在send_json那个方法里，copilot在headers中提示输入'Authorization'字段，并提示这里要给出token，这个填充很有意思，它因为github这个API正好是通过token认证的。当然，由于信息过少，它给的url几乎肯定是错的，这也在情理之中。</p>
<p>比较有意思的是main函数。我只定义了main()方法的函数头，copilot居然自动完成了所有功能的串联，而且应该说，符合预期。</p>
<p>如果上面的例子过于简单，你可以写一些注释，请求copilot为你抓取加密货币价格，通过正则表达式判断是否是有效的邮箱地址，或者压缩、解压缩文件等等。你会发现，copilot的能力是非常强大的。</p>
<p>copilot的神奇之处，绝不只限于上面的举例。作者在实践中确实体验过它的超常能力，比如在单元测试中，自动生成数据序列，或者在生成的代码中，它的错误处理方案会比你自己能写出来的更细腻，等等。但是，要演示那样复杂的功能，已经超出了一本书所以展现的范围了。</p>
<p>这是一些使用者的感言：</p>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>我的一部分工作内容从编写代码转成了策划。作为一个人类可以观察并修正一些代码，不必亲自动手做每一件事。</p>
<p>我对冗余代码的容忍度变高了。让AI去做重复的工作，把代码写得更详细，可以提高可读性。</p>
<p>我更愿意重构代码了。对于那些已经能用但写的不够理想的代码，Copilot可以灵活的完成重构，比如把复杂函数拆分或对关键部分抽象化。</p>
</div>
<p>所以，Don't fly solo（copilot广告语），如果有可能，当你在代码的世界里遨游时，还是让copilot来伴飞吧。当然，copilot也有其不足，其中最重要的一点是，不能免费使用（学生除外），而且每个月10美金的费用对中国程序员来讲可能并不便宜。不仅如此，目前它只接受信用卡和paypal付款，因此在支付上也不够方便。</p>
<h2 id="12-tabnine">1.2. tabnine<a class="headerlink" href="#12-tabnine" title="Permanent link">&para;</a></h2>
<p>另一个选项是<a href="https://www.tabnine.com/">tabnine</a>，与copilot一样，它也提供了从自然语言到代码的转换，以及整段函数的生成等功能。一些评论认为，它比copilot多出的一个功能是，它能基于语法规则在一行还未结束时就给出代码提示，而copilot只能在一行结束后给出整段代码，即copilot需要更多的上下文信息。</p>
<p>tabnine与copilot的值得一提的区别是它的付费模式。tabnine提供了基础版和专业版两个版本，而copilot只能付费使用。tabnine的专业版还有一个特色，就是你可以基于自己的代码训练自己的私有AI模型，从而得到更为个性化的代码完成服务。这个功能对于一些大型公司来说，可能是一个很好的选择。它的另一个优势就是，它在训练自己时只使用实行宽松开源许可证模式的代码，因此，你的代码不会因为使用了tabnine生成的代码，就必须开源出去。</p>
<p><a href="https://github.com/CodedotAl/gpt-code-clippy/wiki">GPT code clippy</a>是Github copilot的开源替代品，如果既不能用copilot，也不能使用tabnine，也可以试试这个。不过在我们成文的时候，它还没有提供一个发行版的vscode扩展，只能通过源码安装。</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>说到AI辅助编码，不能不提到这一行的先驱 - Kite。Kite成立于2014年，致力于AI辅助编程，于2021年11月关闭。由于切入市场过早，kite的技术路线也必然相对落后一些，其AI辅助功能主要是基于关键词联想代码片段的模式。等到2020年github的copilot横空出世时，基于大规模语料、超大规模的深度学习模型被证明才是最有希望的技术路线。而此时kite多年以来的投入和技术积累，不仅不再是有效资产，反而成为了历史包袱。往新的技术路线上的切换的代价往往是巨大的 -- 用户体验也难免改变，而且新的模型所需要的钞能力，kite也并不具备。</p>
<p>2021年11月16日，创始人Adam Smith发表了一篇告别演说，对kite为什么没有成功进行了反思，指出尽管Kite每个月有超过50万月活跃用户，但这么多月活跃用户基本不付费，这最终压垮了kite。当然，终端用户其实也没有错，毕竟copilot的付费模式能够行得通。人们不为kite付费，也确实是因为kite还不够好。</p>
<p>属于kite的时代已经过去了，但正如Adam Smith所说，未来是光明的。AI必将引发一场编程革命。kite的试验失败了，但催生这场AI试验的所有人：投资人，开发团队以及最终用户，他们的勇气和贡献都值得被铭记。</p>
<p>作为一个曾经使用过kite，也欠Kite一个会员的使用者，我也在此道声感谢与珍重！</p>
</div>
<p>尽管AI辅助编程的功能很好用，但仍然有一些场景，我们需要借助传统的工具，比如pylance。pylance是微软官方出品的扩展。vscode本身只是一个通用的IDE框架，对具体某个语言的开发支持（编辑、语法高亮、语法检查、调试等），都是由该语言的扩展及语言服务器（对python而言，有jedi和pylance两个实现）来实现的，因此，pylance是我们在vscode中开发python项目时，必须安装的一个扩展。</p>
<p>它可以随用户输入时，提示函数的签名、文档和进行参数的类型提示，如下图所示：
<img alt="" src="https://images.jieyu.ai/images/2023/01/20230112144603.png" /></p>
<p>Pylance在上面提到的代码自动完成之外，还能实现依赖自动导入。此外，由于它脱胎于语法静态检查器，所以它还能提示代码中的错误并显示，这正是到目前为止，像copilot这样的人工智能还做不太好的地方。源码级的查错，使得我们可以尽早修正这些错误，这也正是静态语言程序员认为Python做不到的地方。</p>
<p><img alt="" src="http://images.jieyu.ai/images/202104/20210413172416.png" /></p>
<div class="admonition tips">
<p class="admonition-title">Tips</p>
<p>Pylance安装后，需要进行配置。配置文件是pyrightconfig.json，放置在项目根目录下。
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code>{
    &quot;exclude&quot;: [
    &quot;.git&quot;,
    &quot;.eggs&quot;
    ],
    &quot;ignore&quot;: [],
    &quot;reportMissingImports&quot;: true,
    &quot;reportMissingTypeStubs&quot;: false,
    &quot;pythonVersion&quot;: &quot;3.8&quot;
}
</code></pre></div></td></tr></table></div>
这些配置项也可以在vscode中配置，但为了使开发成员使用一致的配置，建议都采用文件配置，并且使用git来管理。</p>
</div>
<h1 id="2-type-hint-type-annotations">2. Type Hint （Type Annotations)<a class="headerlink" href="#2-type-hint-type-annotations" title="Permanent link">&para;</a></h1>
<p>很多人谈到Python时，会觉得它作为一种动态语言，是没有类型检查能力的。这种说法并不准确，Python是弱类型语言，变量可以改变类型，但在运行时，仍然会有类型检查，类型检查失败，就会抛出TypeError：</p>
<p>下面的例子演示了Python中变量是如何改变类型的，以及类型检查只在运行时进行的这一特点：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">one</span> <span class="o">=</span> <span class="mi">1</span>
<span class="o">...</span> <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
<span class="o">...</span>     <span class="n">one</span> <span class="o">+</span> <span class="s2">&quot;two&quot;</span> <span class="c1"># 这一行不会执行，所以不会抛出TypeError</span>
<span class="o">...</span> <span class="k">else</span><span class="p">:</span>
<span class="o">...</span>     <span class="n">one</span> <span class="o">+</span> <span class="mi">2</span>
<span class="o">...</span>
<span class="mi">3</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">one</span> <span class="o">+</span> <span class="s2">&quot;two&quot;</span>     <span class="c1"># 运行到此处时，将进行类型检查，抛出TypeError</span>
<span class="ne">TypeError</span><span class="p">:</span> <span class="n">unsupported</span> <span class="n">operand</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="o">+</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span> <span class="ow">and</span> <span class="s1">&#39;str&#39;</span>
<span class="o">...</span> <span class="n">one</span> <span class="o">=</span> <span class="s2">&quot;one &quot;</span>    <span class="c1"># 变量可以通过赋值改变类型</span>
<span class="o">...</span> <span class="n">one</span> <span class="o">+</span> <span class="s2">&quot;two&quot;</span>     <span class="c1"># 现在类型检查没有问题</span>
<span class="n">one</span> <span class="n">two</span>
</code></pre></div></td></tr></table></div>
<p>但Python曾经确实缺少静态类型检查的能力，这是Python一直以来为人诟病的地方。毕竟，错误发现的越早，修复成本就越低。但这正在成为历史。</p>
<p>类型注解从python 3.0（2006年，PEP 3107，当时还叫function annotations）时被引入，但它的用法和语义并没有得到清晰定义，也没有引起广泛关注和运用。数年之后，PEP 484（type hints including generics）被提出，定义了如何给python代码加上类型提示，这样，type annotation就成为实现type hint的主要手段。因此，当今天人们提到type annotation和type hint时，两者基本上是同一含义。</p>
<p>PEP 484是类型检查的奠基石。但是，仍然有一些问题没有得到解决，比如如何对变量进行类型注解？比如下面的语法在当时还是不支持的：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
        <span class="n">left</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div></td></tr></table></div></p>
<p>2016年8月，PEP 526(syntax for variable annotations)提出，从此，像上文中的注解也是允许的了。</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>PEP 526从提出到被接受为正式标准不到1月的时间，可能是最快被接受的PEP之一。</p>
</div>
<p>PEP 563 (Postponed Evaluation of Annotations) 解决了循环引用的问题。在这个提案之后，我们可以这样写代码：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
    <span class="c1">#left: Optional[Node]  # 这会引起循环引用</span>
    <span class="n">left</span><span class="p">:</span>   <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Node&quot;</span><span class="p">]</span>
    <span class="n">right</span><span class="p">:</span>  <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Node&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
注意到我们在类型Node还没有完成其定义时，就要使用它（即要使用Node来定义自己的一个成员变量的类型），这将引起循环引用。PEP 563的语法，通过在注释中使用字符串，而不是类型本身，解决了这个问题。</p>
<p>在这几个重要的PEP之后，随着Python 3.7的正式发布，社区也开始围绕Type Hint去构建一套生态体系，一些非常流行的python库开始补齐类型注解，在类型检查工具方面，除了最早的mypy之外，一些大公司也跟进开发，比如微软推出了pyright（现在是pylance的核心）来给vscode提供类型检查功能。google推出了pytype，facebook则推出了pyre。在类型注解的基础上，代码自动完成的功能也因此变得更容易、准确，推断速度也更快了。代码重构也因此变得更加容易。</p>
<p>类型检查功能将对Python的未来发展起到深远的影响，可能足够与typescript对js的影响类比。围绕类型检查，除了上面提到的几个最重要的PEP之外，还有：</p>
<ol>
<li>PEP 483（解释了python中类型系统的设计原理，非常值得一读）</li>
<li>PEP 544 (定义了对结构类型系统的支持)</li>
<li>PEP 591 (提出了final限定符)
以及PEP 561等另外18个PEP。此外，还有PEP 692等5个PEP目前还未被正式接受。</li>
</ol>
<p>Python的类型检查可能最早由Jukka Lehtosalo推动，Guido，Łukasz Langa和Ivan Levkivskyi也是最重要的几个贡献者之一。Jukka Lehtosalo出生和成长于芬兰，当他在剑桥大学计算机攻读博士时，在他的博士论文中，他提出了一种名为“类型注解”（Type Annotations）的语法，从而一统静态语言和动态语言。最初的实验是在一种名为Alore的语言上实现的，然后移植到Python上，开发了mypy的最初几个版本。不过很快，他的工作重心就完全转移到Python上面来，毕竟，Python庞大的用户群和开源库才能提供丰富的案例以供实践。</p>
<p>2013年，在圣克拉拉举行的PyCon会议上，他公布了这个项目，并且得到了与Guido交谈的机会。Guido说服他放弃之前的自定义语法，完全遵循Python 3的语法，即PEP 3107提出的函数注解）。在随后他与Guido进行了大量的邮件讨论，并提出了通过注释来对变量进行注解的方案（不过后来的PEP 526提出了更好的方案）。</p>
<p>在Jukka Lehtosalo从剑桥毕业后，受Guido邀请，加入了Dropbox，领导了mypy的开发工作。</p>
<p>这里也可以看出顶尖大学对待学术研究上的开放和不拘一格。大概在2016年前后，我看到斯坦福的网络公开课上还有讲授ios编程的课，当时也是同样的震撼。一是感叹他们选课之新，二是感叹这种应用型的课程，在国内的顶尖大学里，一般是不会开设的，因为大家会觉得顶尖的学术殿堂，不应该有这么“low”的东西。</p>
<p>在有了类型注解之后，现在我们应该这样定义一个函数：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">score</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="k">return</span> <span class="n">score</span>

<span class="n">foo</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
foo函数要求传入字符串，但我们在调用时，错误地传入了一个整数。这在运行时并不会出错，但pylance将会发现这个错误，并且给出警告，当我们把鼠标移动到出错位置，就会出现如下提示：</p>
<p><img alt="" src="https://images.jieyu.ai/images/2023/01/20230114102202.png" /></p>
<p>下面，我们简要地介绍一下type hint的一些常见用法：</p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># 声明变量的类型</span>
<span class="n">age</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># 声明变量类型时，并非一定要初始化它</span>
<span class="n">child</span><span class="p">:</span> <span class="nb">bool</span>

<span class="c1"># 如果一个变量可以是任何类型，也最好声明它为Any。zen of python: explicit is better than implicit</span>
<span class="n">dummy</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">dummy</span> <span class="o">=</span> <span class="s2">&quot;hello&quot;</span>

<span class="c1"># 如果一个变量可以是多种类型，可以使用Union</span>
<span class="n">dx</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
<span class="c1"># 从python 3.10起，也可以使用下面的语法</span>
<span class="n">dx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span>

<span class="c1"># 如果一个变量可以为None,可以使用Optional</span>
<span class="n">dy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>

<span class="c1"># 对python builtin类型，可以直接使用类型的名字，比如int, float, bool, str, bytes等。</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">y</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">z</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;test&quot;</span>

<span class="c1"># 对collections类型，如果是python 3.9以上类型，仍然直接使用其名字：</span>
<span class="n">h</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">i</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">j</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
<span class="n">k</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">}</span>

<span class="c1"># 注意上面的list[], dict[]这样的表达方式。如果我们使用list()，则这将变成一个函数调用，而不是类型声明。</span>

<span class="c1"># 但如果是python 3.8及以下版本，需要使用typing模块中的类型：</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="n">h</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">i</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">j</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
<span class="n">k</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">}</span>

<span class="c1"># 如果你要写一些decorator，或者是公共库的作者，则可能会常用到下面这些类型</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">Coroutine</span><span class="p">,</span> <span class="n">Awaitable</span><span class="p">,</span> <span class="n">AsyncIterable</span><span class="p">,</span> <span class="n">AsyncIterator</span>

<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Callable语法中，第一个参数为函数的参数类型，因此它是一个列表，第二个参数为函数的返回值类型</span>
<span class="n">f</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">foo</span>

<span class="k">def</span> <span class="nf">bar</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
    <span class="n">res</span> <span class="o">=</span> <span class="k">yield</span>
    <span class="k">while</span> <span class="n">res</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="k">yield</span> <span class="nb">round</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;OK&#39;</span>

<span class="n">g</span><span class="p">:</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">bar</span>

<span class="c1"># 我们也可以将上述函数返回值仅仅声明为Iterator:</span>
<span class="k">def</span> <span class="nf">bar</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">res</span> <span class="o">=</span> <span class="k">yield</span>
    <span class="k">while</span> <span class="n">res</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="k">yield</span> <span class="nb">round</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;OK&#39;</span>

<span class="k">def</span> <span class="nf">op</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Awaitable</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">cond</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">spam</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="n">h</span><span class="p">:</span> <span class="n">Awaitable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">op</span><span class="p">()</span>

<span class="c1"># 上述针对变量的类型定义，也一样可以用在函数的参数及返回值类型声明上，比如：</span>
<span class="k">def</span> <span class="nf">stringify</span><span class="p">(</span><span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>

<span class="c1"># 如果函数没有返回值，请声明为返回None</span>
<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<span class="c1"># 你可以给原有类型起一个别名</span>
<span class="n">Url</span> <span class="o">=</span> <span class="nb">str</span>
<span class="k">def</span> <span class="nf">retry</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="n">Url</span><span class="p">,</span> <span class="n">retry_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
此外，type hint还支持一些高级用法，比如TypeVar, Generics, Covariance和contravariance等，这些概念在<a href="https://peps.python.org/pep-0484">PEP484</a>中有定义，另外，<a href="https://peps.python.org/pep-0483/">PEP483</a>和<a href="https://github.com/microsoft/pyright/blob/main/docs/type-concepts.md">understanding typing</a>可以帮助读者更好地理解类型提示，建议感兴趣的读者深入研读。</p>
<p>如果您的代码都做好了type hint，那么IDE基本上能够提供和强类型语言类似的重构能力。需要强调的是，在重构之前，你应该先进行单元测试、代码lint和format，在没有错误之后，再进行重构。如此一来，如果重构之后，单元测试仍然能够通过，则基本表明重构是成功的。</p>
<h1 id="3-pep8-python">3. PEP8 - python代码风格指南<a class="headerlink" href="#3-pep8-python" title="Permanent link">&para;</a></h1>
<p>PEP8是2001年由Guido等人拟定的关于python代码风格的一份提案。PEP8的目的是为了提高python代码的可读性，使得python代码在不同的开发者之间保持一致的风格。PEP8的内容包括：代码布局，命名规范，代码注释，编码规范等。PEP8的内容非常多，在实践中，我们不需要专门去记忆它的规则，只要用对正确的代码格式化工具，最终呈现的代码就一定是符合PEP8标准的。在后面的小节里，我们会介绍这一工具 -- black，因此，我们不打算在此处过多着墨。</p>
<h1 id="4-lint">4. Lint工具<a class="headerlink" href="#4-lint" title="Permanent link">&para;</a></h1>
<p>Lint工具对代码进行逻辑检查和风格检查。逻辑检查是指象使用了未定义的变量，或者定义的变量未使用，没有按 type hint 的约定传入参数等等；风格检查是指变量命名风格、空白符、空行符的使用等。</p>
<p>Python社区有很多Lint工具，比如Plint, PyFlakes, pycodestyle, bandit, Mypy等。此外，还有Flake8和Pylama这样，将这些工具组合起来使用的工具。</p>
<p>在选择Lint工具时，重要的指标是报告错误的完全度和速度。过于完备的错误报告有时候也不见得就是最好，有时候会把你的大量精力牵涉到无意义的排查中 -- 纯粹基于静态分析的查错，有时也不可避免会出现错误；同时也使得运行速度降低。</p>
<h2 id="41-flake8">4.1. flake8<a class="headerlink" href="#41-flake8" title="Permanent link">&para;</a></h2>
<p><code>ppw</code>选择了flake8和mypy作为lint工具。flake8实际上是一组lint工具的组合，它由pycodestyle, pyflakes, mcccab组成。</p>
<h3 id="pycodestyle">pycodestyle<a class="headerlink" href="#pycodestyle" title="Permanent link">&para;</a></h3>
<p>pycodestyle用来检查代码风格（空格、缩进、换行、变量名、字符串单双引号等）是否符合PEP8标准。</p>
<h3 id="pyflakes">pyflakes<a class="headerlink" href="#pyflakes" title="Permanent link">&para;</a></h3>
<p>pyflakes用来检查语法错误，比如，定义但未使用的局部变量，变量重定义错误，未使用的导入，格式化错误等等。人们通常拿它与pylint相对照。pyflakes与pylint相比，所能发现的语法错误会少一些，但误报率更低，速度也更快。在有充分单元测试的情况下，我们更推荐初学者使用pyflakes。</p>
<p>下面是一个pylint报告错误，而pyflakes不能报告的例子：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code>def add(x, y):
    print(x + y)

value: None = add(10, 10)
</code></pre></div></td></tr></table></div>
显然，代码作者忘了给add函数加上返回语句，因此，将value赋值为add(10, 10)的结果是None。pylint会报告错误，但是pyflakes不会。</p>
<p>但是pylint存在一定的误报率，上面的代码交给pylint来进行语法检查，其结果是：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code>xxxx:1:0: C0114: Missing module docstring (missing-module-docstring)
xxxx:1:0: C0116: Missing function or method docstring (missing-function-docstring)
xxxx:1:8: C0103: Argument name &quot;x&quot; doesn&#39;t conform to snake_case naming style (invalid-name)
xxxx:1:11: C0103: Argument name &quot;y&quot; doesn&#39;t conform to snake_case naming style (invalid-name)
xxxx:5:0: E1111: Assigning result of a function call, where the function has no return (assignment-from-no-return)
xxxx:5:0: C0103: Constant name &quot;value&quot; doesn&#39;t conform to UPPER_CASE naming style (invalid-name)
</code></pre></div></td></tr></table></div>
这里第1，2和第5行报告都是正确的。但第3和第4行的报告很难说正确，为了代码的简洁性，我们使用单个字母作为局部变量是很常见的事。PEP8规范也只要求我们不得使用"l"（小写的字母L）, "O"（字母o的大写，很难与数字0区分）, "I"（字母i的大写）。</p>
<p>而最后一行的报告则显然是错误的，这里函数add没有返回值的错误，导致pylint误以为value是一个常量，而不是一个变量。事实上，当你修复掉add函数没有返回值的错误时，pylint就不会报告这个错误了。</p>
<p>这是为什么我们推荐初学者使用pyflakes，而不是pylint的原因。初学者很容易淹没在pylint抛出的一大堆错夹杂着误报的错误报告中，花费大量时间来解决这些误报，却茫然无计。另外，pylint过于严格的错误检查，对还未养成良好编程习惯的初学者，可能会使他们感到沮丧。比如，上面关于缺少文档的错误报告，尽管是正确的，但对初学者来说，要一下子达到所有这些标准，会使得学习曲线变得过于陡峭，从而导致学习的热情降低。</p>
<p>mccabe用来检查代码的复杂度，它把代码按控制流处理成一张图，从而代码的复杂度可以用下面的公式来计算：
<span class="arithmatex">\(M = E - N + P\)</span>，其中E是路径数，N是节点数，P则是决策数。</p>
<p>以下面的代码为例：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">if</span> <span class="p">(</span><span class="n">c1</span><span class="p">())</span>
    <span class="n">f1</span><span class="p">();</span>
<span class="k">else</span>
    <span class="n">f2</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="n">c2</span><span class="p">())</span>
    <span class="n">f3</span><span class="p">();</span>
<span class="k">else</span>
    <span class="n">f4</span><span class="p">();</span>
</code></pre></div></td></tr></table></div>
对应的控制流图可以绘制成为：
<img alt="" height="30%" src="https://images.jieyu.ai/images/2023/01/20230115111237.png" /></p>
<p>上述控制流图中，有9条边，7个结点，1个连接，因此它的复杂度为3。</p>
<h3 id="mccabe">mccabe<a class="headerlink" href="#mccabe" title="Permanent link">&para;</a></h3>
<p>mccabe的名字来源于Thomas J. McCabe，他于1976年在IEEE上发表了"A Complexity Measure"这篇论文，这篇重要文章，被其它学术论文引用超过8000次，被认为是软件工业领域最重要和最有影响力的论文之一，影响了一代人。33年之后，Thomas J. McCabe于2019年被ACM授予最有影响力论文奖。这个奖一年只授予一次，只有授奖当年11年之前的论文才有资格入选，迄今也只颁发了15届，约40人拿到了这个奖项。</p>
<p>Tom McCabe提出，如果这个复杂度在10以下，该段代码就只是一段简单的过程，风险较低；11-20为中等风险；21-50属于高风险高复杂度；如果大于50，则该段代码是不可测试的，具有非常大的风险。</p>
<h3 id="flake8">flake8的配置<a class="headerlink" href="#flake8" title="Permanent link">&para;</a></h3>
<p>配置flake8，可以在根目录下放置.flake8文件。尽管可以把配置整合到pyproject.toml文件中，多数情况下，我们都推荐使用单独的配置文件，以减少pyproject.toml的复杂度。对后面将提到的其它工具的配置文件，我们也是一样的态度。</p>
<p>.flake8是一个ini格式的文件，以下是一个示例：
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">.flake8</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">[flake8]</span>
<span class="c1"># required by black, https://github.com/psf/black/blob/master/.flake8</span>
<span class="na">max-line-length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">88</span>
<span class="na">max-complexity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">18</span>
<span class="na">ignore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">E203, E266, E501, W503, F403, F401</span>
<span class="na">select</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">B,C,E,F,W,T4,B9</span>
<span class="na">docstring-convention</span><span class="o">=</span><span class="s">google</span>
<span class="na">per-file-ignores</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="na">__init__.py</span><span class="o">:</span><span class="s">F401</span>
<span class="na">exclude</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="na">.git,</span>
<span class="w">    </span><span class="na">__pycache__,</span>
<span class="w">    </span><span class="na">setup.py,</span>
<span class="w">    </span><span class="na">build,</span>
<span class="w">    </span><span class="na">dist,</span>
<span class="w">    </span><span class="na">releases,</span>
<span class="w">    </span><span class="na">.venv,</span>
<span class="w">    </span><span class="na">.tox,</span>
<span class="w">    </span><span class="na">.mypy_cache,</span>
<span class="w">    </span><span class="na">.pytest_cache,</span>
<span class="w">    </span><span class="na">.vscode,</span>
<span class="w">    </span><span class="na">.github,</span>
<span class="w">    </span><span class="na">docs/conf.py,</span>
<span class="w">    </span><span class="na">tests</span>
</code></pre></div></td></tr></table></div></p>
<p>我们排除了对test文件进行lint，这也是flake8开发者的推荐，尽管代码可读性十分重要，但是我们不应该在test代码的风格上花太多宝贵时间。这里最初几行配置，是为了与black兼容。如果不这样配置，那么经black格式化的文件，flake8总会报错，而这种报错并无任何意义。</p>
<h2 id="42-mypy">4.2. Mypy<a class="headerlink" href="#42-mypy" title="Permanent link">&para;</a></h2>
<p>flake8承担了代码风格、部分语法错误和代码复杂度检查的工作。但是，它没有处理类型检查方面的错误，这项工作我们只能留给mypy来完成。</p>
<p>ppw中已经集成了mypy模块，并会在tox运行时，自动进行类型检查。看上去，只要我们按照PEP484及几个关联的PEP来做好类型注解，然后简单地运行mypy，似乎就应该万事大吉？然而，实践总是比理论要丰富得多，深刻得多。mypy在运行检查时，常常会遇到第三方库还不支持类型注解的情况，或者因为配置错误，导致mypy得不到预期的结果。遇到这些问题时，就需要我们理解mypy的工作原理，并且对mypy进行一些配置，以便让它能够更好地工作。</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>为什么ppw选择了mypy？如果你使用vscode编程，那么很可能已经使用了pyright作为类型检查器。因为pylance给出的类型检查错误，都来自于pyright。那么ppw为什么还要推荐另一个类型检查器呢？</p>
<p>这是因为，pyright并不是一个纯粹的python解决方案。要安装pyright，还必须安装node。我们认为，在开发环境下，一般只需要安装一次，而且vscode可以帮我们完成安装。但在由tox驱动的矩阵测试环境中，任何非纯python的解决方案都可能带来额外的复杂性。</p>
</div>
<p>首先，让我们从<code>Any</code>这个特殊的类型说起。<code>Any</code>类型用来表明某个变量/值具有动态类型。在代码中，如果存在过多的<code>Any</code>类型，将降低mypy进行代码检查的有效性。</p>
<p>难点在于，<code>Any</code>类型的指定，并不一定来源于我们自己代码中的显式声明（对这一部分，我们可以自行修改，只在非常必要时才小心使用<code>Any</code>）。在mypy中，它还会自动获得和传播。mypy的规则是，在函数体内的局部变量，如果它们没有被显式地声明为某种类型，无论它们是否被赋初值，mypy都会将其推导为<code>Any</code>。而在函数体外的变量，mypy则会依据其初值将其推导为某种类型。mypy这样处理的原因，可能是因为它无法在检查时真正运行这个函数。</p>
<p>我们先看函数体里的变量自动获得<code>Any</code>类型的例子：
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">test.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1"># reveal_type是mypy的一个调试方法，用以揭示某个变量的类型。它仅在mypy检查时才会有定义，并会打印出变量类型。你需要在调试完成后，手动移除这些代码，否则会引起python报告NameError错误。</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x</span><span class="o">.</span><span class="n">foo</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">name</span>
</code></pre></div></td></tr></table></div>
我们将上述代码存为test.py，然后通过mypy来运行检查，我们会得到以下输出：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>test.py:12: note: Revealed type is &quot;Any&quot;
</code></pre></div></td></tr></table></div>
除此之外，并没有其它别的错误。在上述代码中，尽管x被赋值为整数1，但它的类型仍然被mypy推导为<code>Any</code>，因此，我们可以在x上调用任何方法，而不会引起mypy的错误提示。</p>
<p>下面的例子，揭示了函数体外的变量，mypy是如何推导其类型的：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<span class="n">s</span> <span class="o">=</span> <span class="mi">1</span>           <span class="c1"># Statically typed (type int)</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># output: Revealed type is &quot;builtins.int&quot;</span>
<span class="n">d</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mi">1</span>      <span class="c1"># Dynamically typed (type Any)</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>  <span class="c1"># output: Revealed type is &quot;Any&quot;</span>

<span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>         <span class="c1"># Type check error</span>
<span class="n">d</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>         <span class="c1"># OK</span>
</code></pre></div></td></tr></table></div>
其它获得<code>Any</code>类型的情况还包括导入错误。当mypy遇到import语句时，它将首先尝试在文件系统中定位该模块或者其类型桩(type stub)文件。然后 Mypy 将对导入的模块进行类型检查。但是，可能存在导入库不存在（比如名字错误、没有安装到mypy运行的环境中），或者该库没有类型注解信息等情况，这样，mypy就会将导入的模块的类型推导为<code>Any</code>。</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>注意到在第4章中，我们生成的样板工程中，在sample\sample目录下，存在一个名为py.typed的空文件。这个文件会在poetry打包过程中，被复制到打包后的包中。这个文件的作用是，告诉类型检查器(type checker)，这个包中的模块都是具有类型注解的，可以进行类型检查。如果你的包中没有这个文件，那么类型检查器将不会对你的包进行类型检查。</p>
<p>py.typed并不是mypy的发明，而是PEP 561的规定。所有类型检查器都应该遵循这个规定。</p>
</div>
<p>需要注意的是，mypy寻找导入库的方式与python寻找导入库的方式并不完全相同。首先，mypy 有自己的搜索路径。这是根据以下条目计算得出的：</p>
<ol>
<li>MYPYPATH环境变量（目录列表，在 UNIX 系统上以MYPYPATH冒号分隔，在 Windows 上以分号分隔）。</li>
<li>配置文件中的mypy_path配置项。</li>
<li>命令行中给出的源的目录。</li>
<li>标记为类型检查安全的已安装包（请见PEP561）。</li>
<li>typeshed repo的相关目录。</li>
</ol>
<p>其次，除了常规的 Python 文件和包之外，mypy 还会搜索存根文件。搜索模块的规则foo如下：</p>
<ol>
<li>搜索查找搜索路径（见上文）中的每个目录，直到找到匹配项。</li>
<li>如果找到名为的包foo（即foo包含__init__.py或__init__.pyi文件的目录），则匹配。</li>
<li>如果找到名为的存根文件foo.pyi，则匹配。</li>
<li>如果找到名为的 Python 模块foo.py，则匹配。</li>
</ol>
<p>规则比较复杂，不过一般情况下，我们也只需要大致了解即可，在遇到问题时，我们可以通过查阅mypy的文档<a href="https://mypy.readthedocs.io/en/latest/running_mypy.html#finding-imports">如何找到导入库</a>来解决。总之，我们需要了解，如果某个导入库在上面的搜索之后不能找到，mypy就会将该模块的类型推导为<code>Any</code>。</p>
<p>除了上述获得<code>Any</code>的情况外，mypy还会自动将<code>Any</code>类型传播到其他变量上。比如，如果一个变量的类型是<code>Any</code>，那么它的任何属性的类型也是<code>Any</code>，并且任何对类型为<code>Any</code>的调用，也将获得<code>Any</code>类型。请看下面的例子：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># x具有Any类型，foo是x的一个属性，所以x.foo的类型也是`Any`</span>
    <span class="c1"># 既然x.foo的类型是`Any`，那么对x.foo的调用，也将导致mypy将y的类型推导为`Any`</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">foo</span><span class="p">()</span>  
    <span class="n">y</span><span class="o">.</span><span class="n">bar</span><span class="p">()</span>      <span class="c1"># 因此，mypy会认为这个调用是合法的</span>
</code></pre></div></td></tr></table></div></p>
<p>从PEP 484开始建构Python的类型提示大厦，直到PEP 563基本完成大厦的封顶之时，仍有大量的第三方库还不支持类型注解。针对这个现实，Python的类型注解是渐进式的(见PEP 483)，任何类型检查器都必须面对这个现实，并给出解决方案。</p>
<p>Mypy提供了大量的配置项来解决这个问题。这些配置项既可以通过命令行参数传入，也可以通过配置文件传入。</p>
<p>默认地，mypy使用工程目录下的mypy.ini作为其配置文件；如果这个文件找不到，则会依次寻找.mypy.ini（注意前面多一个'.')，pyproject.toml, setup.cfg, $XDG_CONFIG_HOME/mypy/config， ~/.config/mypy/config，最后是~/.mypy.ini。</p>
<p>一个典型的mypy配置文件包括全局配置和针对特定模块、库的设置，示例如下：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">[mypy]</span>
<span class="na">warn_redundant_casts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
<span class="na">warn_unused_ignores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
<span class="na">warn_unused_configs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>

<span class="na">disallow_any_unimported</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
<span class="na">ignore_missing_imports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>

<span class="c1"># 禁止未注解的函数、或者注解不完全的函数。</span>
<span class="na">disallow_untyped_defs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
<span class="c1"># 当disallow_untyped_defs为真时，下面的配置无意义</span>
<span class="c1">#disallow_incomplete_defs = true</span>
<span class="na">disallow_untyped_calls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
<span class="na">disallow_untyped_decorators</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
<span class="c1"># 不允许使用`x: List[Any]` 或者 x: List`</span>
<span class="na">disallow_any_generics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>

<span class="c1"># 显示错误代码</span>
<span class="na">show_error_codes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>

<span class="c1"># 如果函数返回值声明不为Any，但实际返回Any，则发出警告</span>
<span class="na">warn_return_any</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>

<span class="k">[mypy-fire]</span>
<span class="c1"># cli.py中引入了python-fire库，但它没有py.typed文件，这里我们要对该库单独设置允许导入缺失</span>
<span class="na">ignore_missing_imports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
</code></pre></div></td></tr></table></div></p>
<p>示例中给出的配置项目是我们认为较为重要，并且与默认值不同的那些。关于mypy所有配置项目及其含义可以参考<a href="https://mypy.readthedocs.io/en/stable/config_file.html">官方文档</a>。这些配置项，既可以通过配置文件设置，也可以通过命令行方式直接传递给mypy。当然，使用命令行方式传递时，这些配置将在全局范围内发生作用。</p>
<h3 id="421-disallow_untyped_defs">4.2.1. disallow_untyped_defs<a class="headerlink" href="#421-disallow_untyped_defs" title="Permanent link">&para;</a></h3>
<p>默认情况下，mypy的类型检查相当宽松，以便兼容一些陈旧的项目。如果我们想要更严格的类型检查，可以将disallow_untyped_defs设置为true。我们可以来测试一下：
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">test.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">name</span>
</code></pre></div></td></tr></table></div>
函数bar没有加任何类型注解，显然，应该无法通过mypy的类型检查。但如果我们在命令行下执行：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>$ mypy test.py
</code></pre></div></td></tr></table></div>
mypy不会给出任何错误提示。如果我们带上--disallow-untyped-defs参数：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>$ mypy --disallow-untyped-defs test.py
</code></pre></div></td></tr></table></div>
这会提示以下错误：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>test.py:7: error: Function is missing a type annotation  [no-untyped-def]
</code></pre></div></td></tr></table></div>
如果是通过配置文件来设置disallow_untyped_defs，象这种布尔量，分别设置为true或false即可。通过命令行传入参数一定是全局生效，而通过配置文件，则可以在更细致的粒度上进行配置。</p>
<h3 id="allow-incomplete-defs">allow-incomplete-defs<a class="headerlink" href="#allow-incomplete-defs" title="Permanent link">&para;</a></h3>
<p>在上面的配置中，还存在一个名为allow-incomplete-defs的选项，它针对的是函数参数只完成了部分注解的情况。有时候我们需要允许这种情况发生。此时，我们需要mypy仅针对个别场合进行以下配置：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code>[mypy-special_module]
disallow_untyped_defs = false
allow_incomplete_defs = true
</code></pre></div></td></tr></table></div></p>
<h3 id="422-check_untyped_defs">4.2.2. check_untyped_defs<a class="headerlink" href="#422-check_untyped_defs" title="Permanent link">&para;</a></h3>
<p>在下面的代码中，我们把字符串与一个整数相加。这显然并不合理。
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bar</span><span class="p">()</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
    <span class="n">not_very_wise</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
如果存在全局设置disallow_untyped_defs = True。这种情况下，mypy将报告以下错误：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>error: Unsupported operand types for + (&quot;str&quot; and &quot;int&quot;)  [operator]
</code></pre></div></td></tr></table></div>
但事事有例外。在例外情况下，我们也可以退而求其次，通过设置check_untyped_defs = True将可以检查出上述问题。</p>
<h3 id="423-disallow_any_unimportedignore_missing_imports">4.2.3. disallow_any_unimported和ignore_missing_imports<a class="headerlink" href="#423-disallow_any_unimportedignore_missing_imports" title="Permanent link">&para;</a></h3>
<p>我们在前面介绍过，如果mypy无法追踪一个导入库，就会将该模块的类型推断为<code>Any</code>，从而进一步传播到我们的代码里，使得更多的类型检查无法进行。如果我们想要禁止这种情况，可以将disallow_any_unimported设置为True。该参数的缺省值是false。</p>
<p>一般地，我们应该在全局范围内将disallow_any_unimported设置为True，然后针对mypy报告出来的无法处理导入的错误，逐个解决。在ppw生成的项目中，如果我们选择了fire作为命令行工具，则会遇到以下错误：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>error: Skipping analyzing &#39;fire&#39;: found module but no type hints or library stubs  [import]
</code></pre></div></td></tr></table></div>
一般情况下，如果是知名的第三方库，往往在typeshed上注册过类型存根文件，类型检查器（比如mypy)应该能自动找到。如果是不知名的第三方库，我们可以升级它，看最新版本是否支持，或者在pypi上搜索它的存根库。比如，对<code>fire</code>，如果pypi上存在它的存根库，则它的名字一定是<code>types-fire</code>，于是我们可以这样纠正上述问题：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>$ pip install types-fire
</code></pre></div></td></tr></table></div>
到成书时为止，fire的开发者并没有上传存根文件。在这种情况下，我们还可以自己写一个<code>fire.pyi</code>文件，然后将它放到项目的根目录下。关于如何写.pyi文件，请读者自行搜索。</p>
<p>但如果既找不到合适的存根库，我们也没时间来写pyi文件，那么，我们可以将ignore_missing_imports设置为True，这样mypy就不会报错了。请参考上面的配置文件中的第24~26行，不过，我们应该尽力避免使用这个选项。</p>
<h3 id="424-implicit_optional">4.2.4. implicit_optional<a class="headerlink" href="#424-implicit_optional" title="Permanent link">&para;</a></h3>
<p>如果有以下的代码：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">arg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;Union[builtins.str, None]&quot;</span>
</code></pre></div></td></tr></table></div>
我们通过reveal_type得知，mypy将<code>arg</code>的类型推导为Optional[str]。这个推导本身没有错，但是，考虑到zen of python的要求， explicit is better than implicit，我们应该将arg的类型声明为<code>arg: Optional[str]</code>。从0.980起，mypy默认将implicit_optional设置为Flase（即禁止这样使用），因此，这个选项也没有出现在我们的示例中。</p>
<h3 id="425-warn_return_any">4.2.5. warn_return_any<a class="headerlink" href="#425-warn_return_any" title="Permanent link">&para;</a></h3>
<p>一般情况下，我们不应该让函数返回类型为<code>Any</code>（如果真有类型不确定的情况，应该使用泛型）。因此，mypy应该检查这种情况并报告为错误。但是，mypy的缺省配置并不会禁止这种行为，我们需要自行修改。</p>
<p>为了便于理解，我们给出以下错误代码：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<span class="k">def</span> <span class="nf">baz</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">something_that_returns_any</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">something_that_returns_any</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
当warn_return_any = True时，mypy将针对上述代码报告如下：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>error: Returning Any from function declared to return &quot;str&quot;  [no-any-return]
</code></pre></div></td></tr></table></div></p>
<h3 id="426-show_errors_codes-and-warn_unused_ignores">4.2.6. show_errors_codes and warn_unused_ignores<a class="headerlink" href="#426-show_errors_codes-and-warn_unused_ignores" title="Permanent link">&para;</a></h3>
<p>当我们使用了type ignore时，我们一般仍然希望mypy能够报告出错误消息（但不会使类型检查失败）。这可以通过设置show_errors_codes = True来实现，显示错误代码。这对于理解错误原因很有帮助。</p>
<p>随着代码的不断演进，有时候type ignore会变得不再必要。比如，我们依赖的某个第三方库，随着新版本的发布，补全了类型注解。这种情况下，针对它的type ignore就不再必要。及时清理这些陈旧的设置是一种良好习惯。</p>
<h3 id="427-inline-comment">4.2.7. inline comment<a class="headerlink" href="#427-inline-comment" title="Permanent link">&para;</a></h3>
<p>我们还可以通过在代码中添加注释来控制mypy的行为。比如，我们可以通过在代码中添加<code># type: ignore</code>来忽略mypy的检查。如果该注释添加在文件的第一行，那么它将会忽略整个文件的检查。如果添加在某一行的末尾，那么它将会忽略该行的检查。</p>
<p>一般我们更倾向于指定忽略某个具体的错误，而不是忽略整行检查。其语法是 <code># type: ignore[&lt;error-code&gt;]</code>。</p>
<h1 id="5-formatter">5. Formatter工具<a class="headerlink" href="#5-formatter" title="Permanent link">&para;</a></h1>
<p>Formatter工具也有很多种，但是我们几乎没有去考查其它的formatter，就选择了black，只因为它的logo:</p>
<figure>
    <img src="https://images.jieyu.ai/images/2023/01/20230116214626.png" width="250"/>
    <figcaption> The Uncompromising Code Formatter</figcaption>
</figure>

<p>与其它Formatter工具提供了体贴入微的自定义配置不同，Black坚持不让您做任何自定义（几乎）。这样做是有道理的，允许定制只会让团队陷入到无意义地争辩当中，而风格并无对错，习惯就好。我们常常看到在团队里，一些人为代码风格争论，其实他们反对的并不是某种风格本身，他们只是在反对自己的同事而已。</p>
<p>当然Black还是开了一个小窗口，允许你定义代码行的换行长度，Black的推荐是88字符。有的团队会把这个更改为120字符宽，按照阴谋论的观点，幕后的推手可能是生产带鱼屏的资本力量。</p>
<p>在ppw生成的项目中，我们把black的设置放在pyproject.toml中：
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">pyproject.toml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">[tool.black]</span>
<span class="n">line-length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">88</span>
<span class="n">include</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;\.pyi?$&#39;</span>
</code></pre></div></td></tr></table></div></p>
<p>另外一个值得一提的工具是isort。它的作用是对代码中的import语句进行格式化，包括排序，将一行里的多个导入拆分成每行一个导入；始终把导入语句置于正式代码之前等等。通过 ppw向导生成的项目，这个工具也开箱即用的：
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">pyproject.toml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">[tool.isort]</span>
<span class="n">profile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;black&quot;</span>
</code></pre></div></td></tr></table></div>
这里的配置是防止isort与black相冲突。实际上flake8、black和isort都的配置需要精心同步才能避免冲突。一时发生冲突，就会出现这样的情况，被A工具改过的代码，又被B工具改回去，始终无法收敛。</p>
<p>比较遗憾的是，在vscode下没有一个好的工具可以自动移除没有使用的导入。Pycharm是可以做到这一点的。开源的工具中有可以做到这一点的，但是因为容易出错，这里也就不推荐了。</p>
<p>在vscode中，Lint工具可以检查出未使用的导入，然后您需要手动移除。移除未使用的<code>import</code>是必要的，它可以适当加快程序启动速度，降低内存占用，并且避免导入带来的副作用。</p>
<div class="admonition tips">
<p class="admonition-title">Tips</p>
<p>导入不熟悉的第三方库可能是危险的！一些库会在全局作用域加入一些可执行代码，因此当你导入这些库时，这些代码就会被执行。</p>
</div>
<h1 id="6-pre-commit-hooks">6. pre-commit hooks<a class="headerlink" href="#6-pre-commit-hooks" title="Permanent link">&para;</a></h1>
<p>我们把<a href="https://pre-commit.com">pre-commit hooks</a>放在这一章里介绍，是因为高效的编码也必须是正确的编码。有时候我们会觉得国内的公司不需要计划和文档，需求、设计和编码各方之间不需要反复协商和沟通，一个指令下来，就很快得到执行。这被认为是执行力强，是一大体制优势，但这些“执行力”强的公司，却又累得要死。方向不正确，累死又有何益？</p>
<p>pre-commit是一个python包，可以通过pip安装：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>$ pip install pre-commit
</code></pre></div></td></tr></table></div>
pre-commit安装后，会在你的项目目录下创建一个.git/hooks目录，里面有一个pre-commit文件。这个文件是一个shell脚本，它会在你执行git commit命令时被调用。pre-commit hooks的作用是在你提交代码之前，对代码进行检查，如果有错误，就会阻止你提交代码，从而保证代码库不被这些错误的、不合规范的代码污染。</p>
<p>如果使用向导生成项目的话，向导已经为您安装了pre-commit hooks,当您运行<code>git commit</code>命令时，就会看到这样的输出：</p>
<p><img alt="" src="http://images.jieyu.ai/images/202104/20210413181638.png" /></p>
<p>可以看出，pre-commit hooks对换行符进行了检查和修复，调用black进行了格式化，以及调用flake8进行了查错，并报告对f-string的错误使用。</p>
<p>当出现错误时，您必须进行修复后，才能进行再次提交。</p>
<h2 id="61-pre-commit-hooks">6.1. pre-commit hooks的配置<a class="headerlink" href="#61-pre-commit-hooks" title="Permanent link">&para;</a></h2>
<p>在ppw生成的项目中，我们已经集成了这些配置：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">repos</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/Lucas-C/pre-commit-hooks</span>
<span class="w">    </span><span class="nt">rev</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1.1.13</span>
<span class="w">    </span><span class="nt">hooks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">forbid-crlf</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">remove-crlf</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">forbid-tabs</span>
<span class="w">        </span><span class="nt">exclude_types</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">csv</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">remove-tabs</span>
<span class="w">        </span><span class="nt">exclude_types</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">csv</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/pre-commit/pre-commit-hooks</span>
<span class="w">    </span><span class="nt">rev</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v4.1.0</span>
<span class="w">    </span><span class="nt">hooks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">trailing-whitespace</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">check-merge-conflict</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">check-yaml</span>
<span class="w">      </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">--unsafe</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">end-of-file-fixer</span>
<span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/pre-commit/mirrors-isort</span>
<span class="w">    </span><span class="nt">rev</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v5.10.1</span>
<span class="w">    </span><span class="nt">hooks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">isort</span>
<span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/ambv/black</span>
<span class="w">    </span><span class="nt">rev</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">22.3.0</span>
<span class="w">    </span><span class="nt">hooks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">black</span>
<span class="w">      </span><span class="nt">language_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python3.8</span>
<span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://gitlab.com/pycqa/flake8</span>
<span class="w">    </span><span class="nt">rev</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3.9.2</span>
<span class="w">    </span><span class="nt">hooks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flake8</span>
<span class="w">       </span><span class="nt">additional_dependencies</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">flake8-typing-imports==1.10.0</span><span class="p p-Indicator">]</span>
<span class="w">       </span><span class="nt">exclude</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^tests</span>
<span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
<span class="w">    </span><span class="nt">hooks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mypy</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mypy</span>
<span class="w">        </span><span class="nt">entry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mypy</span>
<span class="w">        </span><span class="nt">exclude</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^tests</span>
<span class="w">        </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="w">        </span><span class="nt">types</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">python</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">require_serial</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">verbose</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div></td></tr></table></div>
第一组是pre-commit提供的开箱即用的钩子。首先，它禁止使用windows的换行符，并且将windows的换行符都替换为unix/linux下的换行符。这么做的原因是，如果文件使用unix/linux下的换行符，这些文件基本上都能被windows下的编辑软件正确处理；反之则不然。比如，如果你有一个bash或者perl脚本，但使用了windows换行符，那么，它将不能在unix/linux下运行。</p>
<p>其次，它禁止在文件中使用tab键，并且将tab键替换为空格。从语法上看，只要不混合使用tab键和空格键，这两种方式都是可以的。但是，不同的编辑器（特别是unix/linux下）在对文件进行视觉呈现时，会将tab键展开成不同的宽度，这使得同一份文件，在不同的编辑器里，看上去并不一致，而如果使用space，则不会有这个问题。此外，只使用空格还有另外一个好处，就是赚钱更多：根据stackoverflow对2.8万名专业开发者（排除了学生）的调查，使用空格的开发者的薪资总体上要比使用Tab键的开发都高8.6%。这项报告发表在stackoverflow的2017年6月5日的<a href="https://stackoverflow.blog/2017/06/15/developers-use-spaces-make-money-use-tabs/">博客</a>。</p>
<p>需要注意的是，并非所有的文件中的tab键被需要被替换。典型的例子是在csv文件中，我们可能使用Tab键作为字段之间的分隔符，因此它们必须被保留。因此在上述配置中，我们将csv文件排除在外。</p>
<p>第二组仍然是pre-commit提供的开箱即用的钩子。它首先移除了行尾的多余的空格。关于为什么要移除行尾多余的空格，在PEP8中有简要地说明。然后它检查是否存在未完成合并的代码文件，检查yaml文件是否合乎规范。</p>
<p>注意到这里有一个end-of-file-fixer钩子，这个钩子的作用是，在文件末尾添加一个仅含换行符的空行。相信很少有人真正理解它的含义。实际上，相关的问题在quora和stackoverflow上有很多提问，答案也莫衷一是。</p>
<p>其中一个说法是，POSIX标准中，对一行文本的定义就是零个或多个非换行符加上终止换行符的序列。因此，如果一行文本不以换行符结尾，它就可能被各种工具当成二进制文件。但这并不能解释为什么我们需要给文件末尾添加一个空行。</p>
<p>作者更倾向于这种观点：这主要是为了照顾使用Unix和Linux的人。如果你用vi打开一个文件，想在后面添加一些新的内容，如果该文件以一个空行结尾，那么Ctrl+G就可以直接跳转到文件结尾，立即开始工作。反之，Ctrl+G只能跳到最后一行的开头。</p>
<p>另外一个原因是，如果你想使用cat拼接几个文件文件，如果文件都不是以空行（带换行符）结尾，那么前一个文件的最后一行将会与后一个文件的第一行混合在一起，而不是像期待的那样，各占一行。</p>
<p>在文件尾加上一个空行并不是什么重要的功能，只是unix/linux生态圈里几乎所有的工具都是这么运作的。我们尊重这个习惯就好。</p>
<p>接下来都是在pre-commit中调用第三方工具实现相关功能的配置。我们配置了isort，black， flake8和mypy。</p>
<p>mypy的配置有点与众不同。它没有使用远程的repo，而是使用了local。mypy官方并没有提供与pre-commit的集成，所以我们采用了直接在pre-commit中调用本地mypy命令的方法。</p>
<p>这一章的主题是高效编码。我们先是介绍了代码自动完成工具，然后讲述了如何利用语法检查工具尽早发现并修复错误，避免把这些错误带入到测试甚至生产环境中。在我们介绍的方案中，语法检查是随着您的coding实时展开的，并在向代码库提交时，强制执行一次检查。后面您还会看到，在运行测试时，还会再做一次检查，通过这样分层式的设防与检查，帮助您的项目避免出现重大错误。</p>



    
    


              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="http://qm.qq.com/cgi-bin/qm/qr?_wv=1027&k=zxYR3Hve6OMGLvEdgV4z_ONxcOF3hjMh&authKey=eoPjHqcwDIyiTQRNE6jGw1ReDajzXnGHtkAgwapdicr9n%2FPStD3FKit2miTi0zhC&noverify=0&group_code=578029127" target="_blank" rel="noopener" title="QQ群" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741 0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792 0 0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.zhihu.com/people/hbaaron" target="_blank" rel="noopener" title="知乎" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M170.54 148.13v217.54l23.43.01 7.71 26.37 42.01-26.37h49.53V148.13H170.54zm97.75 193.93h-27.94l-27.9 17.51-5.08-17.47-11.9-.04V171.75h72.82v170.31zm-118.46-94.39H97.5c1.74-27.1 2.2-51.59 2.2-73.46h51.16s1.97-22.56-8.58-22.31h-88.5c3.49-13.12 7.87-26.66 13.12-40.67 0 0-24.07 0-32.27 21.57-3.39 8.9-13.21 43.14-30.7 78.12 5.89-.64 25.37-1.18 36.84-22.21 2.11-5.89 2.51-6.66 5.14-14.53h28.87c0 10.5-1.2 66.88-1.68 73.44H20.83c-11.74 0-15.56 23.62-15.56 23.62h65.58C66.45 321.1 42.83 363.12 0 396.34c20.49 5.85 40.91-.93 51-9.9 0 0 22.98-20.9 35.59-69.25l53.96 64.94s7.91-26.89-1.24-39.99c-7.58-8.92-28.06-33.06-36.79-41.81L87.9 311.95c4.36-13.98 6.99-27.55 7.87-40.67h61.65s-.09-23.62-7.59-23.62v.01zm412.02-1.6c20.83-25.64 44.98-58.57 44.98-58.57s-18.65-14.8-27.38-4.06c-6 8.15-36.83 48.2-36.83 48.2l19.23 14.43zm-150.09-59.09c-9.01-8.25-25.91 2.13-25.91 2.13s39.52 55.04 41.12 57.45l19.46-13.73s-25.67-37.61-34.66-45.86h-.01zM640 258.35c-19.78 0-130.91.93-131.06.93v-101c4.81 0 12.42-.4 22.85-1.2 40.88-2.41 70.13-4 87.77-4.81 0 0 12.22-27.19-.59-33.44-3.07-1.18-23.17 4.58-23.17 4.58s-165.22 16.49-232.36 18.05c1.6 8.82 7.62 17.08 15.78 19.55 13.31 3.48 22.69 1.7 49.15.89 24.83-1.6 43.68-2.43 56.51-2.43v99.81H351.41s2.82 22.31 25.51 22.85h107.94v70.92c0 13.97-11.19 21.99-24.48 21.12-14.08.11-26.08-1.15-41.69-1.81 1.99 3.97 6.33 14.39 19.31 21.84 9.88 4.81 16.17 6.57 26.02 6.57 29.56 0 45.67-17.28 44.89-45.31v-73.32h122.36c9.68 0 8.7-23.78 8.7-23.78l.03-.01z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://github.com/zillionare" target="_blank" rel="noopener" title="Github" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto: aaron_yang@jieyu.ai" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m20 8-8 5-8-5V6l8 5 8-5m0-2H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2Z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.indexes", "navigation.tabs", "navigation.instant", "navigation.tabs.sticky"], "search": "../../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
        <script src="../../../../overrides/javascripts/course.js"></script>
      
        <script src="../../../../overrides/javascripts/katex.js"></script>
      
        <script src="../../../../overrides/javascripts/katex.min.js"></script>
      
        <script src="../../../../overrides/javascripts/auto-render.min.js"></script>
      
    
  </body>
</html>