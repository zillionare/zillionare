## 题目

在一个圆内任取 n 个点，则这 n 个点落在同一个半圆内的概率是多少？

## 概率

概率描述某个事件发生的可能性，取值在 0 到 1 之间。对连续型随机变量，概率等于概率密度函数（Probability Dense Function, PDF）在随机变量取值区间上的积分，并且：

$$
1 = \int f(x)dx
$$

因此，如果知道$n$个点落在同一个半圆内的概率密度函数$f(x)$，那么概率就是：

$$
P_(n) = \int_a^b f(x)dx
$$

但是，这里的$f(x)$如何表示？a 和 b 又是什么？

由于这里的$f(x)$难以得到直观的解释，又是 n 个点的问题，所以，我们考虑使用递归来降级（或者思考）这个问题，把问题转化为：

$$
\begin{align}
P(n) &= P(Xn|P_{n-1})  \times P_{n-1} \\
\end{align}
$$

这里的$P(n)$是当第$n-1$个已经在同一个半圆的情况下，第$n$个点也落在同一个半圆的概率。如果我们在这一步可以得到一个递推公式（即，已知$P_{n-1}$，就能推导出$P_n$），那么就能最终求解出$P_n$。

而对$P(X_n|P_{n-1})$，我们有以下公式：

$$
\begin{align}
P(X_n|P_{n-1}) &= \int P(X_n|{\alpha_{n-1}}=x) f_{\alpha_{n-1}}(x)dx \\
&= \int_0^{2\pi} \frac{2\pi-x}{2\pi} f_{\alpha_{n-1}}(x) dx
\end{align}
$$

从式 2) 到式 3) 实际上是全概率公式在连续型随机变量下的积分表达式。我们可以这样理解这个积分表达式：

1. 前$n-1$个点的最大夹角$\alpha_{n-1}$是一个随机变量，它的取值会影响第 n 个点能否被半圆覆盖。
2. $P(X_n|\alpha_{n-1}=x)$ 表示：在最大夹角是$x$时，第 n 个点落在安全区（即最大夹角以外的区域）的概率。安全区长度是$2\pi-x$，所以概率是
   $$\begin{align}\frac{2\pi-x}{2\pi}\end{align}$$
3. 但$\alpha_{n-1}$可能取不同的值$x$，每个$x$的概率密度是$f_{\alpha_{n-1}}(x)$。
4. 所以要求此时的概率，就要对所有可能的$x$加权平均（积分），即：

$$
P(X_n|P_{n-1}) = \int_0^{2\pi} P(X_n|\alpha_{n-1}=x) f_{\alpha_{n-1}}(x) dx = \int_0^{2\pi} \frac{2\pi-x}{2\pi} f_{\alpha_{n-1}}(x) dx
$$

简言之，这一段的公式是在用“全概率公式”思想，把所有可能的最大夹角$x$的情况都考虑进去，并用概率密度$f_{\alpha_{n-1}}(x)$做加权平均，最终得到条件概率$P(X_n|P_{n-1})$。

__核心是，概率是一种积分（发生在某个取值范围内，而不是某个点上）；期望更是积分__

第 n 个点落在安全区（即最大夹角以外的区域）的概率，可以由下图来理解（均匀分布）：

<div style='width:75%;text-align:center;margin: 0 auto 1rem'>
<img src='https://img2022.cnblogs.com/blog/2112523/202206/2112523-20220628160712307-1911457888.png'>
<span style='font-size:0.8em;display:inline-block;width:100%;text-align:center;color:grey'>图 1</span>
</div>

接下来我们对概率密度函数略作一点讨论。

## 概率密度函数

概率密度函数是连续型随机变量在某一点附近取值的『密集程度』。概率密度本身不是概率（可能类似于梯度、导数？），其数值可以大于 1。

为了理解概率密度函数，我们举一个简单的例子，均匀分布的概率密度函数。

假设随机变量 X 在区间$[0,n]$上均匀分布，则概率密度为$f(x) = \frac{1}{n}$。此时，随机变量 X 落在区间 [a,b](0<a<b<n) 上的**概率**是：

$$
\begin{align}
\int_a^b\frac{1}{n}dx = \frac{b-a}{n}
\end{align}
$$

## 期望

期望（又称均值）是随机变量取值的加权平均值，权重是每个取值对应的概率。

期望一般用符号 E(x) 来表示。X 是随机变量。如果 X 是离散的，那么期望是“每种结果的取值 × 该结果发生的概率”之和，即：

$$
E_x = \sum_{i}^{n}X_{i}.P_i
$$

这里$X_i$是第$i$种结果，$P_i$是对应的概率。

对于连续情况，由于对于$X_i$，不存在对应的概率，只有对应的概率密度，因此期望要通过积分来计算，即：

$$
E(X) = \int_{-\infty}^{\infty} g(x) \cdot f(x) \, dx
$$

这里$g(x)$是任意函数，对应着离散型期望中的$X_i$，而$f(x)$是概率密度函数，对应着离散型期望中的$P_i$（但要注意$P_i$是$f(x)$的某个区间上的积分）。

!!! tip
    如果$g(x)$是一个分段、常数型的函数（取值为$X_1, X_2, ...X_i$），且在每一段上$f(x)$的积分可记为$P_i$，则 $\int_{1}^{i} g(x) f(x) dx = \sum_1^iX_i \cdot P_i$。只要我们看到某个函数乘以概率密度再积分，那么它就是对该函数的期望。


在式 3）中，前一部分（即式 4）是$\alpha_{n-1} = x$在这一点时的概率，$f_{\alpha_{n-1}}$是概率密度函数。因此，这本质上就是一个期望表达式：

$$
\begin{align}
P(n) &= P(Xn|P_{n-1}) \\
&= \int_0^{2\pi} \frac{2\pi-x}{2\pi} f_{\alpha_{n-1}}(x) dx \\
&= E\left[ \frac{2\pi - \alpha_{n-1}}{2\pi}\right] \\
&= \frac{2\pi-E_{\alpha_{n-1}}}{2\pi}
\end{align}
$$

!!! tip
    为何要将式7写成式8的形式？这是因为，使用期望符号后，可以方便地利用期望的线性性质、递推关系等概率论工具，后续推导和公式变换会更简洁。另外，期望符号在离散和连续情形下都适用，便于统一表述和迁移思路。

现在，对$n$个点同属同一个半圆情况下的概率计算，就转换为对$n-1$个点的最大角$\alpha_{n-1}$的期望的计算。

而这个期望，是可以通过递归和归纳来解决的。

## 递归求解$n$个点的最大夹角的期望

我们用$\alpha_n$表示 n 个点能形成的最大角度，因此，$\alpha_2$就表示两个点能形成的最大角度，实际上就是两个点的夹角。

由于两点在圆周上是独立均匀分布的，所以$\alpha_2$会是在$[0,\pi]$上的均匀分布，其概率密度函数为：

$$
\begin{align}
f(\alpha_2) = \frac{1}{\pi}, 0\leq\alpha_2\leq\pi
\end{align}
$$

根据数学期望的公式，我们可以求出$E(\alpha_2)$为：

$$
\begin{align}
E(\alpha_2) &= \int_0^{\pi}\alpha_2\cdot f(\alpha_2)d\alpha_2 \\
&=\int_0^{\pi}\alpha_2 \cdot \frac{1}{\pi}d\alpha_2 \\
&=\frac{1}{\pi}\int_0^{\pi}\alpha_2d\alpha_2 \\
&=\frac{1}{\pi}\left[ \frac{1}{2}\alpha_2^2\right]_0^{pi} \\
&=\frac{1}{\pi}\cdot\frac{1}{2}\pi^2 \\
&=\frac{\pi}{2}
\end{align}
$$

现在，已知圆上的两点夹角大小为$\alpha_2$，现在往圆上加入第三点，那么第三点落入 A 与 B 之间时，三个点的最大夹角$\alpha_3$的数学期望会是多少？

首先，点 C 落在 A 与 B 之间的概率是一个均匀分布，因此概率密度函数为：

$$
f(x) = \frac{\alpha}{2\pi}
$$

当点 C 落入 A 与 B 之间时，三个点的最大夹角的取值（即随机变量取值）恒为$\alpha$。由于两者都是常量，所以，最终我们得到的期望会是：

$$
E(x) = \alpha \times \frac{\alpha}{2\pi}
$$

记住，这里的$E(x)$是已知两个点夹角为$\alpha$时，第三个点落入夹角以内的数学期望。

现在，已知两个点夹角为$\alpha$，第三个点加入后，三个点的夹角在 180 度以内的期望是多少？这是一个分段期望求和的过程，我们已经讨论了其中的一种情况。此外还有两种对称的情况，见图 1。

当 C 点落在两侧时，最大夹角会变大，且最大夹角 (x) 会在$[\alpha_2, \pi]$间均匀分布，此时的条件概率为：

$$
\frac{2(\pi-\alpha_2)}{2\pi-\alpha_2}
$$

该条件下的期望是（概率密度函数为$\frac{1}{\pi - \alpha_2}$)：

$$
\int_{\alpha_2}^{\pi}x\cdot\frac{1}{\pi - \alpha_2}
$$

所以，点 C 落在两侧的（条件）期望会是：

$$
\frac{2(\pi-\alpha_2)}{2\pi-\alpha_2} \cdot \int_{\alpha_2}^{\pi} x \cdot \frac{1}{\pi-\alpha_2} dx
$$

合起来，$E(\alpha_3)$就是：

$$
E(\alpha_3) = \underbrace{\frac{\alpha_2}{2\pi-\alpha_2} \cdot \alpha_2 }_{\text{第 3 点落在最大夹角内}} + \underbrace{\frac{2(\pi-\alpha_2)}{2\pi-\alpha_2} \cdot \int_{\alpha_2}^{\pi} x \cdot \frac{1}{\pi-\alpha_2} dx}_{\text{第 3 点落在两侧}} 
$$

其中，第二项积分化简为：

$$
\frac{2(\pi-\alpha_2)}{2\pi-\alpha_2} \cdot \int_{\alpha_2}^{\pi} x \cdot \frac{1}{\pi-\alpha_2} dx = \frac{2(\pi-\alpha_2)}{2\pi-\alpha_2} \cdot \frac{1}{\pi-\alpha2} \cdot \frac{1}{2}(\pi^2-\alpha_2^2)
$$

合并得：

$$
E(\alpha_3) = \frac{\alpha_2^2}{2\pi-\alpha_2} + \frac{\pi^2-\alpha_2^2}{2\pi-\alpha_2} = \frac{\pi^2}{2\pi-\alpha_2}
$$

代入 $ E(\alpha_2) = \frac{\pi}{2} $ 得：

$$
E(\alpha_3) = \frac{\pi^2}{2\pi-\frac{\pi}{2}} = \frac{\pi^2}{\frac{3\pi}{2}} = \frac{2}{3}\pi
$$

既然$E(\alpha_3) = \frac{\pi^2}{2\pi-\alpha_2} $，由递推公式可得：
      
$$
E(\alpha_n) = \frac{\pi^2}{2\pi-E(\alpha_{n-1})}
$$

由数学归纳法可知，$E(αₙ)=(n−1)/nπ $   ②

归纳结论：

$$
E(\alpha_n) = \frac{n-1}{n}\pi
$$

### 补充讲解数学归纳法

**这里我没有仔细看，因为已确认是对的**

证明最大夹角的期望公式：

$$
E(\alpha_n) = \frac{n-1}{n}\pi
$$

归纳法步骤如下：

1. 基础情形（n=2）：
   $$
   E(\alpha_2) = \frac{\pi}{2}
   $$
   这是因为两个点在圆周上，最大夹角必然是 180°（即 ($\pi$)）。
2. 基础情形 (n=3):
   $$
   E(\alpha_3) = \frac{2}{3}\pi
   $$
3. 归纳假设 ：
   假设对于 n=k 时成立，即：
   $$
   E(\alpha_k) = \frac{k-1}{k}\pi
   $$
4. 归纳到 n=k+1 ：
   根据递推公式：
   $$
   E(\alpha_{k+1}) = \frac{k}{k+1}E(\alpha_k) + \frac{2}{k+1}\int_{E(\alpha_k)}^{\pi} x \cdot f(x) dx
   $$
   但实际上，经过推导，第二项的贡献正好补足，使得最终：
   $$
   E(\alpha_{k+1}) = \frac{k}{k+1} \cdot \frac{k-1}{k}\pi + \frac{1}{k+1}\pi = \frac{k}{k+1}\cdot\frac{k-1}{k}\pi + \frac{1}{k+1}\pi = \frac{k}{k+1}\cdot\frac{k-1}{k}\pi + \frac{1}{k+1}\pi = \frac{k-1}{k+1}\pi + \frac{1}{k+1}\pi = \frac{k}{k+1}\pi
   $$
5. 结论 ：
   由归纳法，公式对所有 n 都成立。
总结 ：数学归纳法的关键在于先验证 n=2 的基础情形，然后假设 n=k 时成立，利用递推关系推出 n=k+1 时也成立，从而证明公式对所有 n 都成立。

## $P(X|P(n-1))$的递推公式

现在，我们将

$$
\begin{align}
E(\alpha_{n-1}) = \frac{n-2}{n-1}\pi
\end{align}
$$

代入到

$$
\begin{align}
P(Xn|P_{n-1}) &= \int_0^{2\pi} \frac{2\pi-x}{2\pi} f_{\alpha_{n-1}}(x) dx \\
&= E\left[ \frac{2\pi - \alpha_{n-1}}{2\pi}\right] \\
&= \frac{2\pi-E_{\alpha_{n-1}}}{2\pi}
\end{align}
$$

就得到：

$$
\begin{align}
P(Xn|P_{n-1}) &= \frac{2\pi-E_{\alpha_{n-1}}}{2\pi}\\
&= \frac{2\pi - \frac{n-2}{n-1}\pi}{2\pi} \\
& = \frac{n}{2(n-1)}
\end{align}
$$

即：

$$
\begin{align}
P(X_n|P_{n-1}) = \frac{n}{2 * (n-1)}
\end{align}
$$

## 最终答案：$P_n$

根据式 1）和式 24），我们得到：

$$
\begin{align}
P_n &= P(Xn|P_{n-1}) * P_{n-1} \\
    &= \frac{n}{2 * (n-1)} *P_{n-1} \\
    &= \frac{n}{2 * (n-1)} * \frac{n-1}{2 * (n-2)} * P_{n-2} \\
    &= \frac{n}{2 * (n-1)} * \frac{n-1}{2 * (n-2)} * ... * \frac{2}{2*2} * \frac{1}{2*1} \\
    &= \frac{n}{2} * \underbrace{{\frac{1}{2}}...\frac{1}{2}}_{\text n-2 个} \\
    &= n * (\frac{1}{2})^{n-1}
\end{align}
$$

再使用一次归纳法，得到：

$$
P_n = \frac{n}{2^{n-1}}
$$

## 另一种解法

对于“n 个点在同一个半圆上的概率”，经典结论是：

$$
P_n = \frac{n}{2^{n-1}}
$$

推导思路如下：

1. 任意取一个点作为基准点，将圆固定，使该点位于半圆的起点。
2. 剩下的 n-1 个点必须全部落在以该点为端点的半圆内。
3. 对于每个点，它有一半概率落在该半圆内，因此，所有 (n-1) 个点落入起点半圆的概率是$(\frac{1}{2})^{n-1}$
4. 由于 n 个点中任选一个作为基准点都可以，因此总概率是前式计算出来的 n 倍。
