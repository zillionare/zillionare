---
title: 9 月 25 日
date: 2025-09-25
excerpt: 分享了两个免费量化交易框架。本期观点：为什么回测中的止盈止损会扭曲回测结果？
---



## 资讯

贝莱德全球主管拉斐尔·萨维表示，**估值并不是主要威胁，自满情绪才是主要威胁**，因为尽管地缘政治存在不确定性，但**增长动力依然强劲**。

除了美国科技领域，**全球估值接近或低于长期平均水平**，与互联网泡沫不同；**人工智能、云计算和搜索都有可靠的收入基础**。

他指出，量化基金在各个周期内都能带来更稳定的回报，减少投资者的时机错误，而人工智能驱动的投资则需要在结构性转变期间进行人类判断。

资料表明，截止今年9月，纳斯达克 100 指数市盈率约为 26.86 倍。标普 500 指数的市盈率约为 23.77 倍。


## 免费资源

这一期的免费资源介绍两个免费、开源量化工具。

### Superalgos

Superalgos 是一个免费开源加密货币交易机器人，具有自动化比特币/加密货币交易软件，算法交易机器人。

---

可视化设计您的加密货币交易机器人，利用集成的图表系统、数据挖掘、回溯测试、模拟交易和多服务器加密机器人部署等功能。最新版1.7进入 beta 阶段。自9月底以来，他们连续发布了多个 night shift 版本。该项目在 github 上获得5000多个 stars。

### 开源量化交易框架 Lean
QuantConnect 是全球领先的开源量化交易平台，集策略研发、回测优化与实盘部署于一体，目前已形成包含 40.2 万量化从业者的活跃社区，日均完成超 1.5 万次回测，月均实盘交易规模达 450 亿美元。
   
作为 QuantConnect 的底层驱动，LEAN（Lean Algorithmic Trading Engine）是一款 Apache 2.0 开源的量化交易框架，采用模块化设计，核心架构包含五大可扩展模块。Lean 项目的地址是https://github.com/QuantConnect/Lean。它在 github 上获得了12.5k 的 stars。

该引擎有以下模块：

1. IDataFeed（数据源模块）
2. ITransactionHandler，模拟订单填充逻辑或对接 Alpaca、Interactive Brokers 等经纪商 API，支持限价单、止损单等复杂订单类型，并内置滑点、手续费与保证金模型。
3. 回测引擎。采用时点数据（Point-in-Time）校准，避免前瞻偏差，支持数千只证券的多资产组合回测，性能达 “分钟级完成周级工作量” 的分布式计算能力
4. IRealtimeHandler，实时事件管理。回测时模拟时间流逝，实盘时按市场时间触发事件（如收盘清算），确保策略在不同环境下的一致性。
5. 扩展插件系统：通过 config.json 配置文件可自定义手续费模型、指标计算逻辑，目前社区已贡献 100+ 技术指标与 37.5 万个实盘算法实例


## 观点：为什么回测中的止盈止损会扭曲回测结果？

在金融交易的世界里，回测是验证一个策略是否有效的基础。当交易员们构建回测模型时，他们常常会加入一个看似明智的风险管理工具：止盈（Take-Profit）和止损（Stop-Loss）。这似乎是天经地义——毕竟，在现实交易中，止盈止损是控制风险和锁定利润的基石。然而，许多金融量化专家，包括像马科斯·德·普拉多这样的顶尖学者，都警告我们：在回测中简单地加入止盈止损，实际上是一个非常危险且具有误导性的做法。

这并非因为止盈止损本身是坏的，而是因为它从根本上扭曲了回测的统计有效性。它让你的回测结果看起来比实际情况好得多，从而为你带来虚假的安全感。

### 虚假的安全感：人为地“截断”亏损

这是最主要的问题。止损机制就像是一个过滤器，它会把你策略中那些本应造成巨大亏损的“路径”在到达某个点位时提前终止。在你的回测报告中，那些可能带来 -5% 甚至 -10% 亏损的交易，最终只显示为 -1% 或 -2% 的止损结果。

这导致了两个严重后果：

1. 收益分布失真：你的回测结果将不再反映一个真实、完整的收益分布。它被人为地“截断”了亏损的尾部，这使得你计算出的夏普比率、卡尔马比率等风险调整后收益指标，都变得异常漂亮。但这种漂亮是虚假的，因为它掩盖了潜在的灾难性亏损风险。

2. 低估了黑天鹅事件：如果一个策略在市场突然暴跌时，其止损功能无法有效执行（比如跳空或流动性枯竭），那么回测中“被截断”的亏损就会在现实中成为现实。回测的理想化结果会让你对策略的稳健性产生严重的误判。

### 统计假设的失效：无法进行公平比较

传统的回测和统计分析通常建立在一些核心假设之上，例如：

* 固定时间窗口：每次交易都持有固定的时间（比如5天），这让你可以对不同交易进行公平的比较。

* 独立同分布（I.I.D.）：尽管金融数据并不完全满足这个假设，但这是许多统计检验的基础。

然而，止盈止损机制打破了这些假设：

* 随机化的持有时间：有了止盈止损，有些交易可能只持有几小时就被平仓了，而有些则持有数天。你无法对这些不同持续时间的交易进行有效的“苹果对苹果”的比较。

* “可选停止”偏差：这是一种统计学上的经典谬误。当你可以在一个实验中，如果结果对自己有利就提前停止，那么你很可能会得到一个具有误导性的“显著”结果。在回测中，止损就是这种“可选停止”的形式——在亏损时尽早停止，在盈利时则继续持有。这使得朴素的p值（衡量偶然性的指标）完全失效。

但是，在回测中我们也不可能不指定止盈止损（毕竟在实盘时会这么做），那么如何扬长避短呢？后续我们将继续跟进这一问题，介绍Marcos López de Prado的《金融市场中的机器学习》以及他著名的**三重屏障法**。


把 google stats 加进来



