# 21 å¤©é©¯åŒ– AI æ‰“å·¥ä»”ï¼šå¼€å‘é‡åŒ–äº¤æ˜“ç³»ç»Ÿï¼ˆå…­ï¼‰  æ—¥çº¿æ•°æ®çš„å®šæ—¶è·å–ç³»ç»Ÿï¼ˆåŸºæœ¬æ¶æ„å®ç°ï¼‰

"æ—¶é—´å°±æ˜¯é‡‘é’±ï¼Œæ•ˆç‡å°±æ˜¯ç”Ÿå‘½"ï¼Œè¿™å¥è¯åœ¨é‡åŒ–äº¤æ˜“é¢†åŸŸä½“ç°å¾—æ·‹æ¼“å°½è‡´ã€‚ä»Šå¤©æ˜¯æˆ‘å’Œ007åˆä½œçš„ç¬¬å…­å¤©ï¼Œæˆ‘å†³å®šè¦è§£å†³ä¸€ä¸ªå›°æ‰°æˆ‘å·²ä¹…çš„é—®é¢˜ï¼šå¦‚ä½•å®ç°æ—¥çº¿æ•°æ®çš„è‡ªåŠ¨å®šæ—¶è·å–ï¼Ÿ

"007ï¼Œæˆ‘éœ€è¦ä¸€ä¸ªå¯é çš„ç³»ç»Ÿï¼Œèƒ½å¤Ÿåœ¨æ¯ä¸ªäº¤æ˜“æ—¥æ”¶ç›˜åè‡ªåŠ¨ä»Tushareè·å–å½“å¤©çš„æ—¥çº¿æ•°æ®ï¼Œå¹¶ä¸”åœ¨å‡Œæ™¨æ—¶åˆ†è·å–å†å²æ•°æ®è¿›è¡Œè¡¥å……ã€‚è¿™ä¸ªç³»ç»Ÿå¿…é¡»è¶³å¤Ÿæ™ºèƒ½ï¼Œèƒ½å¤Ÿé¿å…é‡å¤è·å–æ•°æ®ï¼Œè¿˜è¦èƒ½æ£€æŸ¥æ•°æ®çš„å®Œæ•´æ€§ã€‚"æˆ‘å¯¹ç€å±å¹•è¯´é“ã€‚

007æ²‰é»˜äº†å‡ ç§’é’Ÿï¼Œç„¶åå›ç­”ï¼š"æ”¶åˆ°ğŸ«¡ï¼Œè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„å®šæ—¶ä»»åŠ¡è°ƒåº¦é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦è®¾è®¡ä¸€ä¸ªå®Œæ•´çš„æ—¥çº¿æ•°æ®å®šæ—¶è·å–ç³»ç»Ÿã€‚"

## ç³»ç»Ÿè®¾è®¡çš„æ€è€ƒ

åœ¨å¼€å§‹ç¼–ç ä¹‹å‰ï¼Œæˆ‘å’Œ007è¿›è¡Œäº†æ·±å…¥çš„è®¨è®ºï¼Œæ˜ç¡®äº†ç³»ç»Ÿçš„æ ¸å¿ƒéœ€æ±‚ï¼š

1. **å®šæ—¶è·å–èƒ½åŠ›**ï¼šåœ¨å›ºå®šæ—¶é—´ç‚¹è‡ªåŠ¨æ‰§è¡Œæ•°æ®è·å–ä»»åŠ¡
2. **æ•°æ®å®Œæ•´æ€§æ£€æŸ¥**ï¼šç¡®ä¿æ¯ä¸€å¤©çš„æ•°æ®éƒ½æ˜¯å®Œæ•´çš„
3. **æ™ºèƒ½è·³è¿‡æœºåˆ¶**ï¼šé¿å…é‡å¤è·å–å·²æœ‰æ•°æ®
4. **åˆ†æ‰¹è·å–ç­–ç•¥**ï¼šè§£å†³Tushare APIè°ƒç”¨é™åˆ¶é—®é¢˜
5. **å¼‚å¸¸å¤„ç†æœºåˆ¶**ï¼šå¤„ç†ç½‘ç»œæ³¢åŠ¨ã€APIé™åˆ¶ç­‰å¼‚å¸¸æƒ…å†µ
6. **æ—¥å¿—å’Œç›‘æ§**ï¼šè®°å½•ç³»ç»Ÿè¿è¡ŒçŠ¶æ€ï¼ŒåŠæ—¶å‘ç°é—®é¢˜

"è¿™ä¸ªç³»ç»Ÿçš„æ¶æ„åº”è¯¥å¦‚ä½•è®¾è®¡ï¼Ÿ"æˆ‘é—®é“ã€‚

007å±•ç¤ºäº†ä¸€ä¸ªæ¸…æ™°çš„ç³»ç»Ÿæ¶æ„å›¾ï¼š

```mermaid
graph TD
    %% ä¸»è¦ç»„ä»¶
    Main[ä¸»ç¨‹åº main.py] --> Scheduler[è°ƒåº¦å™¨ scheduler.py]
    Main --> DataFetcher[æ•°æ®è·å– data_fetcher.py]
    Main --> DataProcessor[æ•°æ®å¤„ç† data_processor.py]
    Main --> RedisHandler[Rediså¤„ç† redis_handler.py]
    Main --> ClickHouseHandler[ClickHouseå¤„ç† clickhouse_handler.py]
    
    %% é…ç½®å’Œå·¥å…·
    Config[é…ç½® config.py] --> Main
    Config --> Scheduler
    Config --> DataFetcher
    Config --> RedisHandler
    Config --> ClickHouseHandler
    
    Utils[å·¥å…·å‡½æ•° utils.py] --> DataFetcher
    Utils --> Scheduler
    
    Logger[æ—¥å¿— logger.py] --> Main
    Logger --> Scheduler
    Logger --> DataFetcher
    Logger --> DataProcessor
    Logger --> RedisHandler
    Logger --> ClickHouseHandler
    
    %% ç›‘æ§å’Œå¼‚å¸¸å¤„ç†
    Monitor[ç›‘æ§ monitor.py] --> Scheduler
    Exceptions[å¼‚å¸¸å¤„ç† exceptions.py] --> Main
    
    %% æ•°æ®æµå‘
    DataFetcher -->|è·å–æ•°æ®| TushareAPI[Tushare API]
    DataFetcher -->|è¿”å›æ•°æ®| DataProcessor
    
    %% å¤„ç†æ–¹å¼1ï¼šç›´æ¥å­˜å‚¨
    DataProcessor -->|ç›´æ¥å­˜å‚¨| ClickHouseHandler
    ClickHouseHandler -->|å†™å…¥| ClickHouse[(ClickHouse æ•°æ®åº“)]
    
    %% å¤„ç†æ–¹å¼2ï¼šé€šè¿‡Redisé˜Ÿåˆ—
    DataProcessor -->|å‘å¸ƒæ•°æ®| RedisHandler
    RedisHandler -->|å†™å…¥é˜Ÿåˆ—| Redis[(Redis é˜Ÿåˆ—)]
    RedisConsumer[æ¶ˆè´¹è€… redis_consumer.py] -->|è¯»å–é˜Ÿåˆ—| Redis
    RedisConsumer -->|å­˜å‚¨æ•°æ®| ClickHouseHandler
    
    %% å®šæ—¶ä»»åŠ¡
    Scheduler -->|å®šæ—¶è·å–å½“æ—¥æ•°æ®| DataFetcher
    Scheduler -->|å®šæ—¶è·å–å†å²æ•°æ®| DataFetcher
    Scheduler -->|å®šæ—¶æ›´æ–°è‚¡ç¥¨åˆ—è¡¨| DataFetcher
    Scheduler -->|å®šæ—¶æ›´æ–°äº¤æ˜“æ—¥å†| DataFetcher
    Scheduler -->|å®šæ—¶æ£€æŸ¥è¿æ¥| RedisHandler
    Scheduler -->|å®šæ—¶æ£€æŸ¥è¿æ¥| ClickHouseHandler
    
    %% æ ·å¼
    classDef core fill:#f9f,stroke:#333,stroke-width:2px;
    classDef db fill:#bbf,stroke:#333,stroke-width:2px;
    classDef util fill:#bfb,stroke:#333,stroke-width:2px;
    classDef api fill:#fbb,stroke:#333,stroke-width:2px;
    
    class Main,Scheduler,DataFetcher,DataProcessor,RedisHandler,ClickHouseHandler,RedisConsumer core;
    class Redis,ClickHouse db;
    class Config,Utils,Logger,Monitor,Exceptions util;
    class TushareAPI api;
```

"æˆ‘ä»¬å°†ç³»ç»Ÿåˆ†ä¸ºå¤šä¸ªæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—è´Ÿè´£ç‰¹å®šçš„åŠŸèƒ½ï¼Œè¿™æ ·å¯ä»¥æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚"007è§£é‡Šé“ï¼Œ"é…ç½®æ¨¡å—è´Ÿè´£ç®¡ç†ç³»ç»Ÿé…ç½®ï¼Œæ•°æ®è·å–æ¨¡å—è´Ÿè´£ä»Tushareè·å–æ•°æ®ï¼Œæ•°æ®å¤„ç†æ¨¡å—è´Ÿè´£å¤„ç†æ•°æ®å¹¶å‘å¸ƒåˆ°Redisæˆ–ç›´æ¥å­˜å‚¨åˆ°ClickHouseï¼Œè°ƒåº¦å™¨æ¨¡å—è´Ÿè´£ç®¡ç†å®šæ—¶ä»»åŠ¡ï¼Œç¡®ä¿æ•°æ®è·å–çš„å¯é æ€§ã€‚"

## å®šæ—¶å™¨çš„é­”åŠ›

"å®šæ—¶å™¨æ˜¯æ•´ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒï¼Œ"007ç»§ç»­è¯´é“ï¼Œ"æˆ‘ä»¬å°†ä½¿ç”¨APScheduleråº“æ¥å®ç°å®šæ—¶ä»»åŠ¡è°ƒåº¦ã€‚"

```python
from apscheduler.schedulers.background import BackgroundScheduler
from apscheduler.triggers.cron import CronTrigger
import pytz

scheduler = BackgroundScheduler(timezone=pytz.timezone('Asia/Shanghai'))

# æ¯ä¸ªäº¤æ˜“æ—¥15:30è·å–å½“æ—¥æ•°æ®
scheduler.add_job(
    fetch_daily_data,
    CronTrigger(hour=15, minute=30, day_of_week='mon-fri'),
    id='daily_data_job',
    replace_existing=True
)

# æ¯å¤©å‡Œæ™¨1:00è·å–å†å²æ•°æ®
scheduler.add_job(
    fetch_historical_data,
    CronTrigger(hour=1, minute=0),
    id='historical_data_job',
    replace_existing=True
)

scheduler.start()
```

"è¿™æ ·è®¾ç½®åï¼Œç³»ç»Ÿä¼šåœ¨æ¯ä¸ªå·¥ä½œæ—¥çš„15:30è‡ªåŠ¨è·å–å½“æ—¥æ•°æ®ï¼Œåœ¨æ¯å¤©å‡Œæ™¨1:00è‡ªåŠ¨è·å–å†å²æ•°æ®ã€‚"007è§£é‡Šé“ã€‚

## æ•°æ®å®Œæ•´æ€§çš„ä¿éšœ

"ä½†æ˜¯ï¼Œ"æˆ‘æå‡ºäº†ä¸€ä¸ªå…³é”®é—®é¢˜ï¼Œ"å¦‚æœæŸä¸€å¤©å› ä¸ºç½‘ç»œé—®é¢˜æˆ–è€…å…¶ä»–åŸå› ï¼Œæ•°æ®è·å–å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ"

007å¾®å¾®ä¸€ç¬‘ï¼š"è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦æ•°æ®å®Œæ•´æ€§æ£€æŸ¥æœºåˆ¶ã€‚ç³»ç»Ÿä¼šå®šæœŸæ£€æŸ¥ClickHouseä¸­çš„æ•°æ®ï¼Œæ‰¾å‡ºç¼ºå¤±çš„æ—¥æœŸï¼Œç„¶åè‡ªåŠ¨è¡¥å……è¿™äº›æ•°æ®ã€‚"

```python
def check_data_completeness(start_date, end_date):
    """æ£€æŸ¥æ•°æ®å®Œæ•´æ€§ï¼Œæ‰¾å‡ºç¼ºå¤±çš„æ—¥æœŸ"""
    # è·å–äº¤æ˜“æ—¥å†
    trade_cal = get_trade_calendar(start_date, end_date)

    # æŸ¥è¯¢ClickHouseä¸­å·²æœ‰çš„æ•°æ®æ—¥æœŸ
    existing_dates = query_existing_dates(start_date, end_date)

    # æ‰¾å‡ºç¼ºå¤±çš„æ—¥æœŸ
    missing_dates = set(trade_cal) - set(existing_dates)

    return list(missing_dates)

def complete_missing_data():
    """è¡¥å……ç¼ºå¤±çš„æ•°æ®"""
    # è·å–æœ€è¿‘30å¤©çš„æ—¥æœŸèŒƒå›´
    end_date = datetime.now().strftime('%Y%m%d')
    start_date = (datetime.now() - timedelta(days=30)).strftime('%Y%m%d')

    # æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
    missing_dates = check_data_completeness(start_date, end_date)

    if missing_dates:
        logger.info(f"å‘ç°ç¼ºå¤±æ•°æ®æ—¥æœŸ: {missing_dates}")
        for date in missing_dates:
            fetch_data_for_date(date)
    else:
        logger.info("æ•°æ®å®Œæ•´æ€§æ£€æŸ¥é€šè¿‡ï¼Œæ— ç¼ºå¤±æ•°æ®")
```

"è¿™ä¸ªæœºåˆ¶ç¡®ä¿äº†å³ä½¿æŸä¸€å¤©çš„æ•°æ®è·å–å¤±è´¥ï¼Œç³»ç»Ÿä¹Ÿèƒ½åœ¨åç»­çš„æ£€æŸ¥ä¸­å‘ç°å¹¶è¡¥å……è¿™äº›æ•°æ®ã€‚"007è¡¥å……é“ã€‚

## æ™ºèƒ½è·³è¿‡å·²æœ‰æ•°æ®

"é‡å¤è·å–æ•°æ®ä¼šæµªè´¹APIè°ƒç”¨æ¬¡æ•°å’Œç³»ç»Ÿèµ„æºï¼Œ"æˆ‘è¯´ï¼Œ"æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ™ºèƒ½è·³è¿‡æœºåˆ¶ã€‚"

007ç‚¹ç‚¹å¤´ï¼š"ç³»ç»Ÿä¼šåœ¨è·å–æ•°æ®å‰å…ˆæ£€æŸ¥ClickHouseä¸­æ˜¯å¦å·²ç»å­˜åœ¨è¯¥æ—¥æœŸçš„æ•°æ®ï¼Œå¦‚æœå­˜åœ¨åˆ™è·³è¿‡ï¼Œåªè·å–ç¼ºå¤±çš„æ•°æ®ã€‚"

```python
def fetch_historical_data(days=7, force=False):
    """è·å–å†å²æ•°æ®ï¼Œæ”¯æŒæ™ºèƒ½è·³è¿‡å·²æœ‰æ•°æ®"""
    end_date = datetime.now().strftime('%Y%m%d')
    start_date = (datetime.now() - timedelta(days=days)).strftime('%Y%m%d')

    if not force:
        # æ£€æŸ¥å·²æœ‰æ•°æ®ï¼Œåªè·å–ç¼ºå¤±çš„æ—¥æœŸ
        missing_dates = check_data_completeness(start_date, end_date)
        if not missing_dates:
            logger.info(f"ä» {start_date} åˆ° {end_date} çš„æ•°æ®å·²å®Œæ•´ï¼Œè·³è¿‡è·å–")
            return

        logger.info(f"æ™ºèƒ½è·å–ç¼ºå¤±æ—¥æœŸ: {missing_dates}")
        for date in missing_dates:
            fetch_data_for_date(date)
    else:
        # å¼ºåˆ¶è·å–æ‰€æœ‰æ•°æ®
        logger.info(f"å¼ºåˆ¶è·å–ä» {start_date} åˆ° {end_date} çš„æ‰€æœ‰æ•°æ®")
        fetch_data_for_date_range(start_date, end_date)
```

"è¿™ä¸ªæœºåˆ¶å¤§å¤§æé«˜äº†ç³»ç»Ÿçš„æ•ˆç‡ï¼Œé¿å…äº†ä¸å¿…è¦çš„APIè°ƒç”¨ã€‚"007è¯´ã€‚

"ç”±äºæˆ‘ä»¬åœ¨è·å–æ•°æ®çš„æ—¶å€™å·²ç»ç¡®ä¿è¾“å…¥çš„æ¯ä¸ªæ—¥æœŸçš„æ•°æ®éƒ½æ˜¯å®Œæ•´çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œä¹Ÿåªéœ€è¦åˆ¤æ–­æ—¶é—´åŒºé—´å³å¯ã€‚"æˆ‘æ„Ÿå¹é“ï¼Œâ€œè¿™ä¸ªè®¾è®¡å·§å¦™ï¼â€

## åˆ†æ‰¹è·å–çš„è‰ºæœ¯

"Tushare APIæœ‰è°ƒç”¨é™åˆ¶ï¼Œå¦‚æœä¸€æ¬¡æ€§è·å–æ‰€æœ‰è‚¡ç¥¨çš„æ•°æ®å¯èƒ½ä¼šè¶…å‡ºé™åˆ¶ï¼Œ"æˆ‘æ‹…å¿§åœ°è¯´ã€‚

![](https://images.jieyu.ai/images/2025/05/6_01.png)

"åˆ«æ‹…å¿ƒï¼Œ"007èƒ¸æœ‰æˆç«¹ï¼Œ"æˆ‘ä»¬ä¼šå®ç°åˆ†æ‰¹è·å–ç­–ç•¥ï¼Œå°†è‚¡ç¥¨åˆ—è¡¨åˆ†æˆå¤šä¸ªæ‰¹æ¬¡ï¼Œé€æ‰¹è·å–æ•°æ®ã€‚"

```python
def fetch_data_in_batches(date, batch_size=100):
    """åˆ†æ‰¹è·å–æ•°æ®ï¼Œè§£å†³APIè°ƒç”¨é™åˆ¶é—®é¢˜"""
    # è·å–è‚¡ç¥¨åˆ—è¡¨
    stock_list = get_stock_list()

    # è®¡ç®—æ‰¹æ¬¡æ•°
    total_stocks = len(stock_list)
    batch_count = (total_stocks + batch_size - 1) // batch_size

    logger.info(f"å¼€å§‹åˆ†æ‰¹è·å– {date} çš„æ•°æ®ï¼Œå…± {total_stocks} åªè‚¡ç¥¨ï¼Œåˆ† {batch_count} æ‰¹å¤„ç†")

    for i in range(batch_count):
        start_idx = i * batch_size
        end_idx = min((i + 1) * batch_size, total_stocks)
        batch_stocks = stock_list[start_idx:end_idx]

        logger.info(f"å¤„ç†ç¬¬ {i+1}/{batch_count} æ‰¹ï¼ŒåŒ…å« {len(batch_stocks)} åªè‚¡ç¥¨")

        # è·å–è¿™æ‰¹è‚¡ç¥¨çš„æ•°æ®
        fetch_data_for_stocks(date, batch_stocks)

        # é€‚å½“ä¼‘çœ ï¼Œé¿å…APIè°ƒç”¨è¿‡äºé¢‘ç¹
        if i < batch_count - 1:
            time.sleep(1)
```

"è¿™ä¸ªç­–ç•¥ä¸ä»…è§£å†³äº†APIè°ƒç”¨é™åˆ¶é—®é¢˜ï¼Œè¿˜æé«˜äº†ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚"007è¡¥å……é“ã€‚

## å®æˆ˜æµ‹è¯•

ç†è®ºè®¾è®¡å®Œæˆåï¼Œæˆ‘è¿«ä¸åŠå¾…åœ°æƒ³è¦çœ‹åˆ°ç³»ç»Ÿçš„å®é™…è¿è¡Œæ•ˆæœã€‚

"è®©æˆ‘ä»¬å¯åŠ¨ç³»ç»Ÿï¼Œçœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚"æˆ‘è¯´ã€‚

007æ‰§è¡Œäº†å¯åŠ¨å‘½ä»¤ï¼š

```bash
python main.py start
```

ç³»ç»Ÿå¯åŠ¨åï¼Œæ§åˆ¶å°è¾“å‡ºäº†æ—¥å¿—ä¿¡æ¯ï¼š

```
(course) (base) quantide@mini-one æ—¥çº¿æ•°æ®å®šæ—¶è·å– % python main.py start
2025-05-21 14:23:38,748 - day_bar_fetcher - INFO - Redisè¿æ¥æˆåŠŸ
2025-05-21 14:23:38,791 - day_bar_fetcher - INFO - ClickHouseè¿æ¥æˆåŠŸ
2025-05-21 14:23:38,807 - day_bar_fetcher - INFO - å·²ç¡®ä¿è¡¨ RealTime_DailyLine_DB.day_bar å­˜åœ¨
2025-05-21 14:23:38,807 - day_bar_fetcher - INFO - è°ƒåº¦å™¨åˆå§‹åŒ–æˆåŠŸ
2025-05-21 14:23:38,808 - day_bar_fetcher - INFO - æ­£åœ¨å¯åŠ¨æ—¥çº¿æ•°æ®å®šæ—¶è·å–ç³»ç»Ÿ...
2025-05-21 14:23:38,808 - day_bar_fetcher - INFO - å·²æ·»åŠ æ‰€æœ‰å®šæ—¶ä»»åŠ¡
2025-05-21 14:23:38,809 - day_bar_fetcher - INFO - è°ƒåº¦å™¨å·²å¯åŠ¨
2025-05-21 14:23:38,809 - day_bar_fetcher - INFO - ç³»ç»Ÿå·²å¯åŠ¨ï¼ŒæŒ‰Ctrl+Cç»ˆæ­¢
```

"å¤ªæ£’äº†ï¼ç³»ç»ŸæˆåŠŸå¯åŠ¨ï¼Œå¹¶ä¸”å·²ç»æ·»åŠ äº†æ‰€æœ‰å®šæ—¶ä»»åŠ¡ã€‚"æˆ‘å…´å¥‹åœ°è¯´ã€‚

ä¸ºäº†æµ‹è¯•ç³»ç»Ÿçš„åŠŸèƒ½ï¼Œæˆ‘å†³å®šæ‰‹åŠ¨è§¦å‘ä¸€æ¬¡å½“æ—¥æ•°æ®è·å–ï¼š

```bash
python main.py daily
```

ç³»ç»Ÿç«‹å³å¼€å§‹å·¥ä½œï¼š

```
(course) (base) mini-one:æ—¥çº¿æ•°æ®å®šæ—¶è·å– quantide$ python main.py daily
2025-05-21 16:55:37,018 - day_bar_fetcher - INFO - Tushare APIåˆå§‹åŒ–æˆåŠŸ
2025-05-21 16:55:37,038 - day_bar_fetcher - INFO - Redisè¿æ¥æˆåŠŸ
2025-05-21 16:55:37,099 - day_bar_fetcher - INFO - ClickHouseè¿æ¥æˆåŠŸ
2025-05-21 16:55:37,103 - day_bar_fetcher - INFO - å·²ç¡®ä¿è¡¨ RealTime_DailyLine_DB.day_bar å­˜åœ¨
2025-05-21 16:55:37,104 - day_bar_fetcher - INFO - è°ƒåº¦å™¨åˆå§‹åŒ–æˆåŠŸ
2025-05-21 16:55:37,105 - day_bar_fetcher - INFO - æ‰‹åŠ¨è·å–å½“æ—¥æ•°æ®
2025-05-21 16:55:37,764 - day_bar_fetcher - INFO - è·å–æ—¥çº¿æ•°æ®ï¼Œæ—¥æœŸ: 20250521, è‚¡ç¥¨ä»£ç : æ‰€æœ‰
2025-05-21 16:55:37,764 - day_bar_fetcher - INFO - è·å–è‚¡ç¥¨åˆ—è¡¨...
2025-05-21 16:55:38,530 - day_bar_fetcher - INFO - è·å–è‚¡ç¥¨åˆ—è¡¨æˆåŠŸï¼Œå…± 5416 æ¡è®°å½•
2025-05-21 16:55:38,540 - day_bar_fetcher - INFO - æ—¥æœŸ 20250521 åœ¨ClickHouseä¸­å·²æœ‰ 0 ä¸ªè‚¡ç¥¨çš„æ•°æ®
2025-05-21 16:55:38,540 - day_bar_fetcher - INFO - æ—¥æœŸ 20250521 æ²¡æœ‰å·²å­˜åœ¨çš„æ•°æ®ï¼Œéœ€è¦è·å– 5416 ä¸ªè‚¡ç¥¨çš„æ•°æ®
2025-05-21 16:55:38,540 - day_bar_fetcher - INFO - è·å–æ—¥çº¿æ•°æ®ï¼Œæ—¥æœŸ: 20250521, æ‰¹æ¬¡: 1/6, è‚¡ç¥¨æ•°é‡: 1000
2025-05-21 16:55:39,025 - day_bar_fetcher - INFO - æ‰¹æ¬¡ 1 è·å–æˆåŠŸï¼Œå…± 993 æ¡è®°å½•
2025-05-21 16:55:39,025 - day_bar_fetcher - INFO - è·å–æ—¥çº¿æ•°æ®ï¼Œæ—¥æœŸ: 20250521, æ‰¹æ¬¡: 2/6, è‚¡ç¥¨æ•°é‡: 1000
...
2025-05-21 16:55:42,125 - day_bar_fetcher - INFO - è·å–æ—¥çº¿æ•°æ®æˆåŠŸï¼Œå…± 5390 æ¡è®°å½•
2025-05-21 16:55:42,125 - day_bar_fetcher - INFO - å¼€å§‹å¤„ç†å¹¶å­˜å‚¨ 5390 æ¡æ•°æ®
2025-05-21 16:55:42,151 - day_bar_fetcher - INFO - å·²æ’å…¥ 1000 æ¡æ•°æ®åˆ°ClickHouseè¡¨ RealTime_DailyLine_DB.day_bar
...
RealTime_DailyLine_DB.day_bar
2025-05-21 16:55:42,372 - day_bar_fetcher - INFO - å·²å¤„ç†å¹¶å­˜å‚¨ 5390/5390 æ¡æ•°æ®
2025-05-21 16:55:42,373 - day_bar_fetcher - INFO - æ•°æ®å¤„ç†å’Œå­˜å‚¨å®Œæˆï¼Œå…± 5390 æ¡è®°å½•
2025-05-21 16:55:42,373 - day_bar_fetcher - INFO - æ£€æŸ¥å¹¶è¡¥å……æ—¥æœŸ 20250521 çš„æ•°æ®
2025-05-21 16:55:42,407 - day_bar_fetcher - INFO - æ—¥æœŸ 20250521 åœ¨ClickHouseä¸­å…±æœ‰ 5390 ä¸ªè‚¡ç¥¨çš„æ•°æ®
2025-05-21 16:55:42,418 - day_bar_fetcher - INFO - æ—¥æœŸ 20250521 æ•°æ®å®Œæ•´åº¦: 99.93% (5390/5394), æ˜¯å¦å®Œæ•´: True
2025-05-21 16:55:42,419 - day_bar_fetcher - INFO - æ—¥æœŸ 20250521 çš„æ•°æ®å·²å®Œæ•´ï¼Œæ— éœ€è¡¥å……
2025-05-21 16:55:42,419 - day_bar_fetcher - INFO - å½“æ—¥æ•°æ®è·å–å®Œæˆ
2025-05-21 16:55:42,426 - day_bar_fetcher - INFO - ==================================================
2025-05-21 16:55:42,426 - day_bar_fetcher - INFO - ClickHouseä¸­å·²æœ‰æ•°æ®çš„æ—¶é—´èŒƒå›´: 20250514 - 20250521
2025-05-21 16:55:42,429 - day_bar_fetcher - INFO - ClickHouseä¸­å…±æœ‰ 32344 æ¡æ•°æ®è®°å½•
2025-05-21 16:55:42,429 - day_bar_fetcher - INFO - ==================================================
```

"ç³»ç»Ÿè¿è¡Œå¾—éå¸¸å¥½ï¼Œ"æˆ‘èµå¹é“ï¼Œ"å®ƒæˆåŠŸè·å–äº†å½“æ—¥çš„æ•°æ®ï¼Œå¹¶ä¸”è¯¦ç»†è®°å½•äº†å¤„ç†è¿‡ç¨‹ã€‚"

"å½“ç„¶ï¼Œå¦‚æœä½ å¯¹è·å–æ•°æ®çš„å®Œæ•´æ€§ä¾æ—§æ”¾å¿ƒä¸ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œ`python main.py complete`æˆ–`python main.py info`æ¥æ£€æŸ¥æˆ‘ä»¬å·²ç»å­˜å‚¨çš„æ•°æ®ä¿¡æ¯ã€‚"ï¼Œ007 è¡¥å……é“ã€‚

è¯´ç½¢ï¼Œ007 æ‰§è¡Œäº†ä»¥ä¸‹å‘½ä»¤ï¼š
```
python main.py complete
```

ç³»ç»Ÿæ˜¾ç¤ºäº†å¦‚ä¸‹ Clickhouse çš„ä¿¡æ¯ï¼š

```
2025-05-22 09:40:17,208 - day_bar_fetcher - INFO - Tushare APIåˆå§‹åŒ–æˆåŠŸ
2025-05-22 09:40:17,259 - day_bar_fetcher - INFO - Redisè¿æ¥æˆåŠŸ
2025-05-22 09:40:17,410 - day_bar_fetcher - INFO - ClickHouseè¿æ¥æˆåŠŸ
2025-05-22 09:40:17,426 - day_bar_fetcher - INFO - å·²ç¡®ä¿è¡¨ RealTime_DailyLine_DB.day_bar å­˜åœ¨
2025-05-22 09:40:17,428 - day_bar_fetcher - INFO - è°ƒåº¦å™¨åˆå§‹åŒ–æˆåŠŸ
2025-05-22 09:40:17,429 - day_bar_fetcher - INFO - æ£€æŸ¥å¹¶è¡¥å……æ—¥æœŸèŒƒå›´ æœ€æ—© - æœ€æ–° çš„æ•°æ®
2025-05-22 09:40:17,479 - day_bar_fetcher - INFO - æ—¥æœŸ 20250514 åœ¨ClickHouseä¸­å…±æœ‰ 5391 ä¸ªè‚¡ç¥¨çš„æ•°æ®
2025-05-22 09:40:17,483 - day_bar_fetcher - INFO - æ—¥æœŸ 20250514 æ•°æ®å®Œæ•´åº¦: 99.94% (5391/5394), æ˜¯å¦å®Œæ•´: True
2025-05-22 09:40:17,485 - day_bar_fetcher - INFO - æ—¥æœŸ 20250515 åœ¨ClickHouseä¸­å…±æœ‰ 5390 ä¸ªè‚¡ç¥¨çš„æ•°æ®
2025-05-22 09:40:17,488 - day_bar_fetcher - INFO - æ—¥æœŸ 20250515 æ•°æ®å®Œæ•´åº¦: 99.93% (5390/5394), æ˜¯å¦å®Œæ•´: True
2025-05-22 09:40:17,490 - day_bar_fetcher - INFO - æ—¥æœŸ 20250516 åœ¨ClickHouseä¸­å…±æœ‰ 5391 ä¸ªè‚¡ç¥¨çš„æ•°æ®
2025-05-22 09:40:17,494 - day_bar_fetcher - INFO - æ—¥æœŸ 20250516 æ•°æ®å®Œæ•´åº¦: 99.94% (5391/5394), æ˜¯å¦å®Œæ•´: True
2025-05-22 09:40:17,498 - day_bar_fetcher - INFO - æ—¥æœŸ 20250519 åœ¨ClickHouseä¸­å…±æœ‰ 5388 ä¸ªè‚¡ç¥¨çš„æ•°æ®
2025-05-22 09:40:17,501 - day_bar_fetcher - INFO - æ—¥æœŸ 20250519 æ•°æ®å®Œæ•´åº¦: 99.89% (5388/5394), æ˜¯å¦å®Œæ•´: True
2025-05-22 09:40:17,503 - day_bar_fetcher - INFO - æ—¥æœŸ 20250520 åœ¨ClickHouseä¸­å…±æœ‰ 5394 ä¸ªè‚¡ç¥¨çš„æ•°æ®
2025-05-22 09:40:17,507 - day_bar_fetcher - INFO - æ—¥æœŸ 20250520 æ•°æ®å®Œæ•´åº¦: 100.00% (5394/5394), æ˜¯å¦å®Œæ•´: True
2025-05-22 09:40:17,510 - day_bar_fetcher - INFO - æ—¥æœŸ 20250521 åœ¨ClickHouseä¸­å…±æœ‰ 5390 ä¸ªè‚¡ç¥¨çš„æ•°æ®
2025-05-22 09:40:17,512 - day_bar_fetcher - INFO - æ—¥æœŸ 20250521 æ•°æ®å®Œæ•´åº¦: 99.93% (5390/5394), æ˜¯å¦å®Œæ•´: True
2025-05-22 09:40:17,512 - day_bar_fetcher - INFO - æ—¥æœŸèŒƒå›´ 20250514 - 20250521 å†…å…±æœ‰ 0 ä¸ªä¸å®Œæ•´çš„æ—¥æœŸ
2025-05-22 09:40:17,512 - day_bar_fetcher - INFO - æ‰€æœ‰æ—¥æœŸçš„æ•°æ®éƒ½å·²å®Œæ•´ï¼Œæ— éœ€è¡¥å……
2025-05-22 09:40:17,515 - day_bar_fetcher - INFO - ==================================================
2025-05-22 09:40:17,515 - day_bar_fetcher - INFO - ClickHouseä¸­å·²æœ‰æ•°æ®çš„æ—¶é—´èŒƒå›´: 20250514 - 20250521
2025-05-22 09:40:17,517 - day_bar_fetcher - INFO - ClickHouseä¸­å…±æœ‰ 32344 æ¡æ•°æ®è®°å½•
2025-05-22 09:40:17,517 - day_bar_fetcher - INFO - ==================================================
```

ä¸ºäº†ä¿è¯ç³»ç»Ÿçš„åŠŸèƒ½æ€§ï¼Œæˆ‘ä»¬å¢åŠ äº†ä¸€äº›å‚æ•°æ¥æ›´å¥½çš„ä½¿ç”¨è¯¥ç³»ç»Ÿï¼š

### å¯åŠ¨ç³»ç»Ÿ

```bash
python main.py start
```

### æ‰‹åŠ¨è·å–å½“æ—¥æ•°æ®

```bash
# è·å–å½“æ—¥æ•°æ®
python main.py daily

# ä½¿ç”¨åˆ†æ‰¹è·å–ï¼Œæ¯æ‰¹100ä¸ªè‚¡ç¥¨
python main.py daily --batch-size 100
```

### æ‰‹åŠ¨è·å–å†å²æ•°æ®

```bash
# è·å–æœ€è¿‘7å¤©çš„å†å²æ•°æ®
python main.py history --days 7

# è·å–æŒ‡å®šæ—¥æœŸèŒƒå›´çš„å†å²æ•°æ®
python main.py history --start 20230101 --end 20230107

# å¼ºåˆ¶è·å–æ‰€æœ‰æ•°æ®ï¼Œä¸è·³è¿‡å·²å­˜åœ¨çš„æ•°æ®
python main.py history --days 7 --force

# ä½¿ç”¨åˆ†æ‰¹è·å–ï¼Œæ¯æ‰¹100ä¸ªè‚¡ç¥¨
python main.py history --days 7 --batch-size 100
```

### æ£€æŸ¥å¹¶è¡¥å……ä¸å®Œæ•´çš„æ•°æ®

```bash
# æ£€æŸ¥å¹¶è¡¥å……æ‰€æœ‰ä¸å®Œæ•´çš„æ•°æ®
python main.py complete

# æ£€æŸ¥å¹¶è¡¥å……æŒ‡å®šæ—¥æœŸçš„æ•°æ®
python main.py complete --date 20230101

# æ£€æŸ¥å¹¶è¡¥å……æŒ‡å®šæ—¥æœŸèŒƒå›´çš„æ•°æ®
python main.py complete --start 20230101 --end 20230107

# ä½¿ç”¨åˆ†æ‰¹è·å–ï¼Œæ¯æ‰¹100ä¸ªè‚¡ç¥¨
python main.py complete --batch-size 100
```

### æ˜¾ç¤ºæ•°æ®ä¿¡æ¯

```bash
# æ˜¾ç¤ºClickHouseä¸­çš„æ•°æ®ä¿¡æ¯ï¼ˆæ—¶é—´èŒƒå›´å’Œè®°å½•æ•°é‡ï¼‰
python main.py info
```

### æ‰‹åŠ¨æ›´æ–°è‚¡ç¥¨åˆ—è¡¨

```bash
python main.py stock_list
```

### æ‰‹åŠ¨æ›´æ–°äº¤æ˜“æ—¥å†

```bash
python main.py trade_cal
```

### æ‰‹åŠ¨æ£€æŸ¥è¿æ¥

```bash
# æ£€æŸ¥æ‰€æœ‰è¿æ¥
python main.py check

# åªæ£€æŸ¥Redisè¿æ¥
python main.py check --redis

# åªæ£€æŸ¥ClickHouseè¿æ¥
python main.py check --clickhouse
```

## æˆæœä¸å±•æœ›

ç»è¿‡ä¸€å¤©çš„åŠªåŠ›ï¼Œæˆ‘å’Œ007æˆåŠŸå®ç°äº†æ—¥çº¿æ•°æ®å®šæ—¶è·å–ç³»ç»Ÿã€‚è¿™ä¸ªç³»ç»Ÿå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. **å¯é çš„å®šæ—¶æ‰§è¡Œ**ï¼šåœ¨æŒ‡å®šæ—¶é—´è‡ªåŠ¨è·å–æ•°æ®
2. **æ™ºèƒ½çš„æ•°æ®ç®¡ç†**ï¼šé¿å…é‡å¤è·å–ï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§
3. **é«˜æ•ˆçš„åˆ†æ‰¹å¤„ç†**ï¼šè§£å†³APIè°ƒç”¨é™åˆ¶é—®é¢˜
4. **å®Œå–„çš„å¼‚å¸¸å¤„ç†**ï¼šåº”å¯¹å„ç§å¼‚å¸¸æƒ…å†µ
5. **è¯¦ç»†çš„æ—¥å¿—è®°å½•**ï¼šæ–¹ä¾¿ç›‘æ§å’Œé—®é¢˜æ’æŸ¥

"è¿™ä¸ªç³»ç»Ÿå°†å¤§å¤§å‡è½»æˆ‘ä»¬çš„å·¥ä½œè´Ÿæ‹…ï¼Œ"æˆ‘æ€»ç»“é“ï¼Œ"ä¸å†éœ€è¦æ‰‹åŠ¨è·å–æ•°æ®ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å®Œæˆæ‰€æœ‰å·¥ä½œã€‚"

007è¡¥å……é“ï¼š"è€Œä¸”ï¼Œç³»ç»Ÿçš„æ¨¡å—åŒ–è®¾è®¡ä½¿å¾—æˆ‘ä»¬å¯ä»¥è½»æ¾æ‰©å±•å…¶åŠŸèƒ½ï¼Œæ¯”å¦‚æ·»åŠ æ›´å¤šçš„æ•°æ®æºã€æ”¯æŒæ›´å¤šçš„æ•°æ®ç±»å‹ç­‰ã€‚"

"æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘å°†è¿™ä¸ªç³»ç»Ÿä¸æˆ‘ä»¬ä¹‹å‰å¼€å‘çš„å…¶ä»–æ¨¡å—é›†æˆï¼Œæ„å»ºä¸€ä¸ªå®Œæ•´çš„é‡åŒ–äº¤æ˜“å¹³å°ã€‚"æˆ‘å±•æœ›æœªæ¥ã€‚

"æ²¡é—®é¢˜ï¼Œ"007è‡ªä¿¡åœ°è¯´ï¼Œ"æœ‰äº†è¿™ä¸ªå¯é çš„æ•°æ®åŸºç¡€ï¼Œæˆ‘ä»¬å¯ä»¥æ›´ä¸“æ³¨äºç­–ç•¥å¼€å‘å’Œå›æµ‹ä¼˜åŒ–ã€‚"

å¤œå¹•é™ä¸´ï¼Œæˆ‘å…³é—­äº†ç”µè„‘ï¼Œå¿ƒä¸­å……æ»¡äº†æˆå°±æ„Ÿã€‚21å¤©çš„æŒ‘æˆ˜å·²ç»è¿‡å»äº†å…­å¤©ï¼Œæˆ‘å’Œ007çš„åˆä½œè¶Šæ¥è¶Šé»˜å¥‘ï¼Œé‡åŒ–äº¤æ˜“ç³»ç»Ÿä¹Ÿåœ¨ä¸€æ­¥æ­¥æˆå‹ã€‚æ˜å¤©ï¼Œæˆ‘ä»¬å°†ç»§ç»­å‰è¿›ï¼Œè¿æ¥æ–°çš„æŒ‘æˆ˜ï¼

![](https://images.jieyu.ai/images/2025/05/6_02.png)

## æ€»ç»“

æ—¥çº¿æ•°æ®å®šæ—¶è·å–ç³»ç»Ÿæ˜¯é‡åŒ–äº¤æ˜“å¹³å°çš„é‡è¦åŸºç¡€è®¾æ–½ï¼Œå®ƒç¡®ä¿äº†æ•°æ®çš„åŠæ—¶æ€§å’Œå®Œæ•´æ€§ã€‚é€šè¿‡ç²¾å¿ƒè®¾è®¡çš„æ¶æ„å’Œç®—æ³•ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªé«˜æ•ˆã€å¯é çš„ç³»ç»Ÿï¼Œä¸ºåç»­çš„ç­–ç•¥å¼€å‘å’Œå›æµ‹æä¾›äº†åšå®çš„æ•°æ®æ”¯æŒã€‚

è¿™ä¸ªç³»ç»Ÿä¸ä»…è§£å†³äº†æ•°æ®è·å–çš„é—®é¢˜ï¼Œè¿˜ä½“ç°äº†è½¯ä»¶å·¥ç¨‹çš„ä¼˜ç§€å®è·µï¼šæ¨¡å—åŒ–è®¾è®¡ã€å¼‚å¸¸å¤„ç†ã€æ—¥å¿—è®°å½•ã€é…ç½®ç®¡ç†ç­‰ã€‚è¿™äº›å®è·µä½¿å¾—ç³»ç»Ÿå…·æœ‰è‰¯å¥½çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ï¼Œèƒ½å¤Ÿé€‚åº”æœªæ¥çš„éœ€æ±‚å˜åŒ–ã€‚

è§‚å¯Ÿåˆ°ä¸Šå›¾çš„è¡¨ä¸­ä»ç„¶æœ‰éƒ¨åˆ†å­—æ®µå­˜åœ¨é—®é¢˜ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç« èŠ‚è¿›è¡Œä¿®å¤ã€‚æ•¬è¯·æœŸå¾…ï½

![](https://images.jieyu.ai/images/2025/05/quantide3.jpg)